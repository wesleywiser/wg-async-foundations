<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>wg-async-foundations</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="welcome.html"><strong aria-hidden="true">1.</strong> 👋🏽 Welcome</a></li><li class="chapter-item "><a href="vision.html"><strong aria-hidden="true">2.</strong> 🔮 The vision</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="vision/how_to_vision.html"><strong aria-hidden="true">2.1.</strong> ❓How to vision</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="vision/how_to_vision/projects.html"><strong aria-hidden="true">2.1.1.</strong> Projects</a></li><li class="chapter-item "><a href="vision/how_to_vision/status_quo.html"><strong aria-hidden="true">2.1.2.</strong> &quot;Status quo&quot; stories</a></li><li class="chapter-item "><a href="vision/how_to_vision/shiny_future.html"><strong aria-hidden="true">2.1.3.</strong> &quot;Shiny future&quot; stories</a></li><li class="chapter-item "><a href="vision/how_to_vision/comment.html"><strong aria-hidden="true">2.1.4.</strong> Commenting</a></li><li class="chapter-item "><a href="vision/how_to_vision/awards.html"><strong aria-hidden="true">2.1.5.</strong> Awards</a></li></ol></li><li class="chapter-item "><a href="vision/tenets.html"><strong aria-hidden="true">2.2.</strong> ✏️ Design tenets for async</a></li><li class="chapter-item "><a href="vision/characters.html"><strong aria-hidden="true">2.3.</strong> 🙋‍♀️ Cast of characters</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="vision/characters/alan.html"><strong aria-hidden="true">2.3.1.</strong> Alan</a></li><li class="chapter-item "><a href="vision/characters/grace.html"><strong aria-hidden="true">2.3.2.</strong> Grace</a></li><li class="chapter-item "><a href="vision/characters/niklaus.html"><strong aria-hidden="true">2.3.3.</strong> Niklaus</a></li><li class="chapter-item "><a href="vision/characters/barbara.html"><strong aria-hidden="true">2.3.4.</strong> Barbara</a></li></ol></li><li class="chapter-item "><a href="vision/projects.html"><strong aria-hidden="true">2.4.</strong> ⚡ Projects</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="vision/projects/template.html"><strong aria-hidden="true">2.4.1.</strong> Template</a></li><li class="chapter-item "><a href="vision/projects/MonsterMesh.html"><strong aria-hidden="true">2.4.2.</strong> MonsterMesh (embedded sensors)</a></li><li class="chapter-item "><a href="vision/projects/DistriData.html"><strong aria-hidden="true">2.4.3.</strong> DistriData (Generic Infrastructure)</a></li><li class="chapter-item "><a href="vision/projects/TrafficMonitor.html"><strong aria-hidden="true">2.4.4.</strong> TrafficMonitor (Custom Infrastructure)</a></li><li class="chapter-item "><a href="vision/projects/YouBuy.html"><strong aria-hidden="true">2.4.5.</strong> YouBuy (Traditional Server Application)</a></li><li class="chapter-item "><a href="vision/projects/SLOW.html"><strong aria-hidden="true">2.4.6.</strong> SLOW (Protocol implementation)</a></li></ol></li><li class="chapter-item "><a href="vision/status_quo.html"><strong aria-hidden="true">2.5.</strong> 😱 Status quo</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="vision/status_quo/template.html"><strong aria-hidden="true">2.5.1.</strong> Template</a></li><li class="chapter-item "><a href="vision/status_quo/alan_runs_into_stack_trouble.html"><strong aria-hidden="true">2.5.2.</strong> Alan runs into stack trouble</a></li><li class="chapter-item "><a href="vision/status_quo/alan_hates_writing_a_stream.html"><strong aria-hidden="true">2.5.3.</strong> Alan hates writing a Stream</a></li><li class="chapter-item "><a href="vision/status_quo/alan_started_trusting_the_rust_compiler_but_then_async.html"><strong aria-hidden="true">2.5.4.</strong> Alan started trusting the Rust compiler, but then... async</a></li><li class="chapter-item "><a href="vision/status_quo/barbara_makes_their_first_steps_into_async.html"><strong aria-hidden="true">2.5.5.</strong> Barbara makes their first foray into async</a></li><li class="chapter-item "><a href="vision/status_quo/grace_deploys_her_service.html"><strong aria-hidden="true">2.5.6.</strong> Grace deploys her service and hits obstacles</a></li><li class="chapter-item "><a href="vision/status_quo/niklaus_wants_to_share_knowledge.html"><strong aria-hidden="true">2.5.7.</strong> Niklaus wants to share knowledge</a></li></ol></li><li class="chapter-item "><a href="vision/shiny_future.html"><strong aria-hidden="true">2.6.</strong> ✨ Shiny future</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="vision/shiny_future/template.html"><strong aria-hidden="true">2.6.1.</strong> Template</a></li></ol></li><li class="chapter-item "><a href="vision/roadmap.html"><strong aria-hidden="true">2.7.</strong> 📅 Roadmap for 2021</a></li></ol></li><li class="chapter-item "><a href="triage.html"><strong aria-hidden="true">3.</strong> 🔍 Triage meetings</a></li><li class="chapter-item "><a href="design_docs.html"><strong aria-hidden="true">4.</strong> 🔬 Design docs</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="design_docs/yield_safe.html"><strong aria-hidden="true">4.1.</strong> ⚠️ Yield-safe lint</a></li><li class="chapter-item "><a href="design_docs/stream.html"><strong aria-hidden="true">4.2.</strong> ☔ Stream trait</a></li><li class="chapter-item "><a href="design_docs/generator_syntax.html"><strong aria-hidden="true">4.3.</strong> ⚡ Generator syntax</a></li><li class="chapter-item "><a href="design_docs/async_read_write.html"><strong aria-hidden="true">4.4.</strong> 📝 AsyncRead, AsyncWrite traits</a></li><li class="chapter-item "><a href="design_docs/async_fn_in_traits.html"><strong aria-hidden="true">4.5.</strong> 🧬 Async fn in traits</a></li><li class="chapter-item "><a href="design_docs/mutex.html"><strong aria-hidden="true">4.6.</strong> 🔒 Mutex (future-aware)</a></li><li class="chapter-item "><a href="design_docs/channels.html"><strong aria-hidden="true">4.7.</strong> 📺 Async aware channels</a></li><li class="chapter-item "><a href="design_docs/async_closures.html"><strong aria-hidden="true">4.8.</strong> 📦 Async closures</a></li><li class="chapter-item "><a href="design_docs/join.html"><strong aria-hidden="true">4.9.</strong> 🤝 Join combinator</a></li><li class="chapter-item "><a href="design_docs/select.html"><strong aria-hidden="true">4.10.</strong> 🤷‍♀️ Select combinator</a></li><li class="chapter-item "><a href="design_docs/sink_trait.html"><strong aria-hidden="true">4.11.</strong> 🚰 Sink trait</a></li><li class="chapter-item "><a href="design_docs/async_main.html"><strong aria-hidden="true">4.12.</strong> 🎇 Async main</a></li><li class="chapter-item "><a href="design_docs/async_drop.html"><strong aria-hidden="true">4.13.</strong> 🗑️ Async drop</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="design_docs/async_lifecycle.html"><strong aria-hidden="true">4.13.1.</strong> ♻️ Async lifecycle</a></li></ol></li><li class="chapter-item "><a href="design_docs/completion_based_futures.html"><strong aria-hidden="true">4.14.</strong> ⏳ Completion-based futures</a></li></ol></li><li class="chapter-item "><a href="conversations.html"><strong aria-hidden="true">5.</strong> 💬 Conversations</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="conversations/2021-02-12-Twitter-Thread.html"><strong aria-hidden="true">5.1.</strong> 🐦 2021-02-12 Twitter thread</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">wg-async-foundations</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/rust-lang/wg-async-foundations" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="-welcome"><a class="header" href="#-welcome">👋🏽 Welcome</a></h1>
<p>Welcome to the wg-async-foundations website!</p>
<h2 id="leads"><a class="header" href="#leads">Leads</a></h2>
<p>The leads of this working group are <a href="https://github.com/tmandry">@tmandry</a> and <a href="https://github.com/nikomatsakis">@nikomatsakis</a>. Both of them can be found on <a href="welcome.html#zulip">Zulip</a>.</p>
<h2 id="getting-involved"><a class="header" href="#getting-involved">Getting involved</a></h2>
<p>There is a weekly <a href="./triage.html">triage meeting</a> that takes place in our <a href="welcome.html#zulip">Zulip stream</a>. Feel free to stop by then (or any time!) to introduce yourself. </p>
<p>If you're interested in fixing bugs, though, there is no need to wait for the meeting! <a href="./triage.html#so-you-want-to-fix-a-bug">Take a look at the instructions here.</a></p>
<h2 id="what-is-the-goal-of-this-working-group"><a class="header" href="#what-is-the-goal-of-this-working-group">What is the goal of this working group?</a></h2>
<p>This working group is focused around implementation/design of the “foundations” for Async I/O. This means that we are focused on designing and implementing extensions to the language, standard library, and other &quot;core&quot; bits of support offered by the Rust organization. We do not directly work on external projects like <a href="https://tokio.rs/">tokio</a>, <a href="https://async.rs/">async-std</a>, <a href="https://github.com/smol-rs/smol/">smol</a>, <a href="https://github.com/akiles/embassy">embassy</a> and so forth, although we definitely discuss ideas and coordinate with them where appropriate.</p>
<h2 id="zulip"><a class="header" href="#zulip">Zulip</a></h2>
<p>We hold discussions on <a href="https://rust-lang.zulipchat.com/#narrow/stream/187312-wg-async-foundations">the <code>#wg-async-foundations</code> stream in Zulip</a></p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>Licensed under either of</p>
<ul>
<li>Apache License, Version 2.0 (<a href="LICENSE-APACHE">LICENSE-APACHE</a> or http://www.apache.org/licenses/LICENSE-2.0)</li>
<li>MIT license (<a href="LICENSE-MIT">LICENSE-MIT</a> or http://opensource.org/licenses/MIT)</li>
</ul>
<p>at your option.</p>
<h3 id="contribution"><a class="header" href="#contribution">Contribution</a></h3>
<p>Unless you explicitly state otherwise, any contribution intentionally submitted
for inclusion in this crate by you, as defined in the Apache-2.0 license, shall
be dual licensed as above, without any additional terms or conditions.</p>
<h1 id="-the-vision"><a class="header" href="#-the-vision">🔮 The vision</a></h1>
<h2 id="what-is-this"><a class="header" href="#what-is-this">What is this</a></h2>
<p>We believe Rust can become one of the most popular choices for building distributed systems, ranging from embedded devices to foundational cloud services. Whatever they're using it for, we want all developers to love using Async Rust. For that to happen, we need to move Async Rust beyond the &quot;MVP&quot; state it's in today and make it accessible to everyone.</p>
<p>This document is a collaborative effort to build a shared vision for Async Rust. <strong>Our goal is to engage the entire community in a collective act of the imagination:</strong> how can we make the end-to-end experience of using Async I/O not only a pragmatic choice, but a <em>joyful</em> one?</p>
<h2 id="where-we-are-and-where-we-are-going"><a class="header" href="#where-we-are-and-where-we-are-going">Where we are and where we are going</a></h2>
<p>The &quot;vision document&quot; starts with a <a href="./vision/characters.html">cast of characters</a>. Each character is tied to a particular Rust value (e.g., performance, productivity, etc) determined by their background; this background also informs the expectations they bring when using Rust. <a href="./vision/characters/grace.html">Grace</a>, for example, wants to keep the same level of performance she currently get with C, but with the productivity benefits of memory safety. <a href="./vision/characters/alan.html">Alan</a>, meanwhile, is hoping Rust will give him higher performance without losing the safety and ergonomics that he enjoys with garbage collected languages. </p>
<p>For each character, we write <a href="./vision/status_quo.html">&quot;status quo&quot; stories</a> that describe the challenges they face as they try to achieve their goals (and typically fail in dramatic fashion!), <strong>These stories are not fiction.</strong> They are an amalgamation of the real experiences of people using Async Rust, as reported to us by interviews, blog posts, and tweets. Writing these stories helps us gauge the cumulative impact of the various papercuts and challenges that one enconters when using Async Rust.</p>
<p>The ultimate goal of the vision doc, of course, is not just to tell us where we are now, but where we are going and how we will get there. For this, we include <a href="./vision/shiny_future.html">&quot;shiny future&quot; stories</a> that tell us how those same characters will fare in a few years time, when we've had a chance to improve the Async Rust experience.</p>
<h2 id="the-vision-drives-the-work"><a class="header" href="#the-vision-drives-the-work">The vision drives the work</a></h2>
<p>The vision is not just idle speculation. It is the central document that we use to organize ourselves. When we think about our <a href="./vision/roadmap.html">roadmap</a> for any given year, it is always with the aim of moving us closer to the vision we lay out here.</p>
<h2 id="involving-the-whole-community"><a class="header" href="#involving-the-whole-community">Involving the whole community</a></h2>
<p>The async vision document provides a forum where the Async Rust community can plan a great overall experience for Async Rust users. Async Rust was intentionally designed not to have a &quot;one size fits all&quot; mindset, and we don't want to change that. Our goal is to build a shared vision for the end-to-end experience while retaining the loosely coupled, exploration-oriented ecosystem we have built.</p>
<h2 id="-under-construction-help-needed-"><a class="header" href="#-under-construction-help-needed-">🚧 Under construction! Help needed! 🚧</a></h2>
<p>This document is not yet complete! We are actively working on it as part of the working group, and we would like your help! Check out the <a href="./vision/how_to_vision.html">How to vision doc</a> page for more details.</p>
<h1 id="-how-to-vision"><a class="header" href="#-how-to-vision">❓ How to vision</a></h1>
<h2 id="how-you-can-help"><a class="header" href="#how-you-can-help">How you can help</a></h2>
<table><thead><tr><th>When</th><th>What</th></tr></thead><tbody>
<tr><td>✅ <strong>Now</strong> till 2021-04-30</td><td>Improve the <a href="vision/./how_to_vision/projects.html">sample projects</a></td></tr>
<tr><td>✅ <strong>Now</strong> till 2021-04-30</td><td>Propose new <a href="vision/./how_to_vision/status_quo.html">&quot;status quo&quot; stories</a> or <a href="vision/./how_to_vision/comment.html">comment</a> on existing PRs</td></tr>
<tr><td>🛑 Starting 2021-04-02</td><td>Propose new <a href="vision/./how_to_vision/shiny_future.html">&quot;shiny future&quot; stories</a> or <a href="vision/./how_to_vision/comment.html">comment</a> on existing PRs</td></tr>
<tr><td>🛑 Starting 2021-04-30</td><td>Vote for the <a href="vision/./how_to_vision/awards.html">awards</a> on the status quo and shiny future stories!</td></tr>
</tbody></table>
<h2 id="the-big-picture"><a class="header" href="#the-big-picture">The big picture</a></h2>
<p>The process we are using to write the vision doc encourages active collaboration and &quot;positive sum&quot; thinking. It starts with a brainstorming period, during which we aim to collect as many &quot;status quo&quot; and &quot;shiny future&quot; stories as we can. </p>
<p>This brainstorming period runs for six weeks, until the end of April. For the first two weeks (until 2021-04-02), we are collecting <a href="vision/./how_to_vision/status_quo.html">&quot;status quo&quot; stories</a> only. After that, we will accept both <a href="vision/./how_to_vision/status_quo.html">&quot;status quo&quot;</a> and <a href="vision/./how_to_vision/shiny_future.html">&quot;shiny future&quot; stories</a> until the end of the brainstorming period. Finally, to cap off the brainstorming period, we will select winners for <a href="vision/./how_to_vision/awards.html">awards</a> like &quot;Most Humorous Story&quot; or &quot;Most Supportive Contributor&quot;. </p>
<p>Once the brainstorming period is complete, the working group leads will begin work on assembling the various stories and shiny futures into a coherent draft. This draft will be reviewed by the community and the Rust teams and adjusted based on feedback.</p>
<h3 id="brainstorming"><a class="header" href="#brainstorming">Brainstorming</a></h3>
<p>The brainstorming period runs until 2021-04-30:</p>
<ul>
<li>Folks open &quot;status quo&quot; and (starting 2021-04-02) &quot;shiny future&quot; story PRs against the <a href="https://github.com/rust-lang/wg-async-foundations">wg-async-foundations repo</a>.
<ul>
<li><a href="vision/./how_to_vision/status_quo.html">Templates and instructions for status quo stories can be found here.</a> </li>
<li>You can also browse the <a href="https://github.com/rust-lang/wg-async-foundations/labels/status-quo-story-ideas">open &quot;status quo&quot; issues</a> for ideas!</li>
<li><a href="vision/./how_to_vision/shiny_future.html">Templates and instructions for shiny future stories can be found here.</a></li>
</ul>
</li>
<li>We collectively <a href="vision/./how_to_vision/comment.html">comment</a> on these PRs, helping to improve them and make them more complete.</li>
<li>Unless they contain factual inaccuracies, the aim is to merge <strong>all</strong> PRs opened in the brainstorming period.
<ul>
<li>We also expect people to sometimes extend other stories with additional details or FAQs.</li>
</ul>
</li>
<li>At the end of the brainstorming period, we will vote and give <a href="vision/./how_to_vision/awards.html">awards</a> for things like &quot;most amusing&quot;. (We'd like suggestions on the best categories!)</li>
</ul>
<h4 id="the-more-the-merrier"><a class="header" href="#the-more-the-merrier">The more the merrier!</a></h4>
<p><strong>During this brainstorming period, we want to focus on getting as many ideas as we can.</strong> Having multiple &quot;shiny futures&quot; that address the same problem is a feature, not a bug, as it will let us mix-and-match later to try and find the best overall plan. Comments and questions will be used as a <a href="vision/./how_to_vision/comment.html">tool for improving understanding or sharpening proposals.</a> Presenting alternative ideas is done by <a href="https://nikomatsakis.github.io/wg-async-foundations/vision/how_to_vision/comment.html#you-might-just-want-to-write-your-own-story">writing an alternative story</a>.</p>
<h4 id="reviewing-contributions"><a class="header" href="#reviewing-contributions">Reviewing contributions</a></h4>
<p>To merge a story or project PR, any member of the working group can open a topic on Zulip and propose it be merged. Ideally there will be no outstanding concerns. If a second member of the working group approves, the PR can then be merged.</p>
<p>Reviewers should ensure that new stories and projects are added to the <code>SUMMARY.md</code> file either before merging or directly afterwards.</p>
<h3 id="harmonizing"><a class="header" href="#harmonizing">Harmonizing</a></h3>
<p>At this point, the <a href="vision/../welcome.html#leads">wg leads</a> will write the draft vision document, drawing on the status quo and shiny future stories that were submitted.
Like an RFC, this draft vision doc will be opened for comment and improved based on the resulting feedback.
When the <a href="vision/../welcome.html#leads">wg leads</a> feel it is ready, it will be taken to the <a href="https://www.rust-lang.org/governance/teams/lang">lang</a> and <a href="https://www.rust-lang.org/governance/teams/library">libs</a> teams for approval (and other Rust teams as appropriate).</p>
<h3 id="living-document"><a class="header" href="#living-document">Living document</a></h3>
<p>This meant to be a <strong>living document</strong>. We plan to revisit it regularly to track our progress and update it based on what we've learned in the meantime. Note that the shiny future stories in particular are going to involve a fair bit of uncertainty, so we expect them to change as we go.</p>
<h2 id="wait-did-somebody-say-awards"><a class="header" href="#wait-did-somebody-say-awards">Wait, did somebody say awards?</a></h2>
<p>Yes! We are planning to give <a href="vision/./how_to_vision/awards.html">awards</a> in various categories for folks who write <a href="vision/./how_to_vision/status_quo.html">status quo</a> and <a href="vision/./how_to_vision/shiny_future.html">shiny future</a> PRs. The precise categories are TBD. Check out the <a href="vision/./how_to_vision/awards.html">awards</a> page for more details.</p>
<h1 id="-how-to-vision-projects"><a class="header" href="#-how-to-vision-projects">❓ How to vision: Projects</a></h1>
<h2 id="how-to-open-a-pr"><a class="header" href="#how-to-open-a-pr">How to open a PR</a></h2>
<p>If you'd like to add a new project, please <a href="vision/how_to_vision/../status_quo/template.html">open a PR using this template</a> and adding a new file into <a href="vision/how_to_vision/../projects.html">the <code>projects</code> directory</a>. Do not add your file to <a href="vision/how_to_vision/../../SUMMARY.html"><code>SUMMARY.md</code></a>, that will create conflicts. We'll add it after merging.</p>
<p>We are pretty happy to add new projects, although we would prefer only to add a new project if it has some characteristic that is distinct from the other projects we've got so far and which is important to a 'status quo' or 'shiny future' story.</p>
<h2 id="faqs-to-answer-in-your-pr"><a class="header" href="#faqs-to-answer-in-your-pr">FAQs to answer in your PR</a></h2>
<p>In your PR, make sure to include the following FAQs:</p>
<ul>
<li>What makes this project different from most others?</li>
<li>Are there existing crates that are similar to this project?</li>
</ul>
<h1 id="-how-to-vision-status-quo-stories"><a class="header" href="#-how-to-vision-status-quo-stories">❓ How to vision: &quot;Status quo&quot; stories</a></h1>
<p>We want to make sure all Async Rust users and their experiences are reflected in the async vision doc, so please help us by writing 'status quo' stories about your experiences or the experiences of others! Remember, <strong>status quo stories are not &quot;real&quot;, but neither are they fiction.</strong> They are constructed from the real experiences of people using Async Rust (often multiple people). </p>
<h2 id="tldr"><a class="header" href="#tldr">TL;DR</a></h2>
<p>Just want to get started? Here are quick instructions to get you going:</p>
<ul>
<li><strong>To write your own story:</strong>
<ul>
<li>Create a PR based on the <a href="https://github.com/rust-lang/wg-async-foundations/tree/master/src/vision/status_quo/template.md">&quot;status quo&quot; template</a>. </li>
<li>Do not add your file to <a href="https://github.com/rust-lang/wg-async-foundations/blob/master/src/SUMMARY.md"><code>SUMMARY.md</code></a> -- that will create conflicts, we'll do it manually after merging.</li>
</ul>
</li>
<li><strong>To get feedback on a story idea, or look for someone else to write it:</strong>
<ul>
<li>Open up a <a href="https://github.com/rust-lang/wg-async-foundations/issues/new?assignees=&amp;labels=good+first+issue%2C+help+wanted%2C+status-quo-story-ideas&amp;template=-status-quo--story-issue.md&amp;title=">&quot;status quo&quot; story issue</a> on the <a href="https://github.com/rust-lang/wg-async-foundations/">wg-async-foundations repository</a>.</li>
</ul>
</li>
<li><strong>To find ideas of what to write, or to share your experiences:</strong>
<ul>
<li>Search the <a href="https://github.com/rust-lang/wg-async-foundations/issues?q=is%3Aopen+is%3Aissue+label%3Astatus-quo-story-ideas">open issues tagged as status-quo-story-idea</a>.</li>
<li>Remember to <a href="vision/how_to_vision/./comment.html">comment supportively</a>.</li>
</ul>
</li>
</ul>
<h2 id="optional-open-an-issue-to-discuss-your-story-or-find-others-with-similar-experiences"><a class="header" href="#optional-open-an-issue-to-discuss-your-story-or-find-others-with-similar-experiences">Optional: open an issue to discuss your story or find others with similar experiences</a></h2>
<p>If you have a story idea but you don't have the time to write about it, or if you would like to know whether other folks have encountered the same sorts of problems, you can <a href="https://github.com/rust-lang/wg-async-foundations/issues/new?assignees=&amp;labels=good+first+issue%2C+help+wanted%2C+status-quo-story-ideas&amp;template=-status-quo--story-issue.md&amp;title=">open up a &quot;status quo&quot; story issue</a> on the <a href="https://github.com/rust-lang/wg-async-foundations/">wg-async-foundations repository</a>. Alternatively, if you're looking for a story to write, you can browse the <a href="https://github.com/rust-lang/wg-async-foundations/issues?q=is%3Aopen+is%3Aissue+label%3Astatus-quo-story-ideas">open issues tagged as status-quo-story-idea</a> and see if anything catches your eye. If you see people describing problems you have hit, or have questions about the experiences people are sharing, then please leave a comment -- but remember to <a href="vision/how_to_vision/./comment.html">comment supportively</a>. (You can also come to <a href="vision/how_to_vision/../../welcome.html#Zulip">Zulip</a> to discuss.)</p>
<h2 id="how-to-open-a-pr-1"><a class="header" href="#how-to-open-a-pr-1">How to open a PR</a></h2>
<p>If you have an idea you'd like to write about, please <a href="https://github.com/rust-lang/wg-async-foundations/tree/master/src/vision/status_quo/template.md">open a PR using this template</a> and adding a new file into <a href="https://github.com/rust-lang/wg-async-foundations/tree/master/src/vision/status_quo">the <code>status_quo</code> directory</a>. Do not add your file to <a href="https://github.com/rust-lang/wg-async-foundations/blob/master/src/SUMMARY.md"><code>SUMMARY.md</code></a> -- that will create conflicts, we'll do it manually after merging.</p>
<h2 id="goals-of-a-status-quo-pr"><a class="header" href="#goals-of-a-status-quo-pr">Goals of a status quo PR</a></h2>
<p>When writing a <a href="vision/how_to_vision/../status_quo.html">status quo</a> story, your goal is to present what you see as a major challenge for Async Rust. You want to draw upon people's experiences (sometimes multiple people) to show all the aspects of the problem in an engaging and entertaining way.</p>
<p>Each story is always presented from the POV of a particular <a href="vision/how_to_vision/../characters.html">character</a>. Stories should be detailed, not abstract -- it's better to give specifics than generalities. Don't say &quot;Grace visited a website to find the answer to her question&quot;, tell us whether she went to stackoverflow, asked on reddit, or found the answer on some random blog post. Ideally you should get this detail from whatever your &quot;source&quot; of the story is -- but if you are using multiple sources and they disagree, you can pick one and use the FAQ to convey some of the other alternatives.</p>
<h2 id="the-role-of-the-faq"><a class="header" href="#the-role-of-the-faq">The role of the FAQ</a></h2>
<p>Every status quo PR includes a FAQ. This FAQ should always include answers to some standard questions:</p>
<ul>
<li>What are the morals of the story?
<ul>
<li>Talk about the major takeaways-- what do you see as the biggest problems.</li>
</ul>
</li>
<li>What are the sources for this story?
<ul>
<li>Talk about what the story is based on, ideally with links to blog posts, tweets, or other evidence.</li>
</ul>
</li>
<li>Why did you choose <em>NAME</em> to tell this story?
<ul>
<li>Talk about the character you used for the story and why.</li>
</ul>
</li>
<li>How would this story have played out differently for the other characters?
<ul>
<li>In some cases, there are problems that only occur for people from specific backgrounds, or which play out differently. This question can be used to highlight that.</li>
</ul>
</li>
</ul>
<p>You can feel free to add whatever other FAQs seem appropriate. You should also expect to grow the FAQ in response to questions that come up on the PR.</p>
<h2 id="the-review-process"><a class="header" href="#the-review-process">The review process</a></h2>
<p>When you open a status quo PR, people will start to <a href="vision/how_to_vision/./comment.html">comment</a> on it. These comments should always be constructive, with the goal not of negating the story but of making it more precise or more persuasive. Ideally, you should respond to every comment in one of two ways:</p>
<ul>
<li>Adjust the story with more details or to correct factual errors.</li>
<li>Add something to the story's FAQ to explain the confusion.
<ul>
<li>If the question is already covered by a FAQ, you can just refer the commenter to that.</li>
</ul>
</li>
</ul>
<p>The goal is that, at the end of the review process, the status quo story has a lot more details that address the major questions people had.</p>
<h2 id="-frequently-asked-questions"><a class="header" href="#-frequently-asked-questions">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What is the process to propose a status quo story?</strong>
<ul>
<li>Just open a PR <a href="https://github.com/rust-lang/wg-async-foundations/tree/master/src/vision/status_quo/template.md">using this template</a>.</li>
<li>Do not add your file to <a href="https://github.com/rust-lang/wg-async-foundations/blob/master/src/SUMMARY.md"><code>SUMMARY.md</code></a>, that will create conflicts. We'll do it after merging.</li>
</ul>
</li>
<li><strong>What if my story applies to multiple characters?</strong>
<ul>
<li>Look at the &quot;morals&quot; of your story and decide which character will let you get those across the best.</li>
<li>Use the FAQ to talk about how other characters might have been impacted.</li>
<li>If the story would play out really differently for other characters, maybe write it more than once!</li>
</ul>
</li>
<li><strong>How much detail should I give? How specific should I be?</strong>
<ul>
<li>Detailed is generally better, but only if those details are helpful for understanding the morals of your story.</li>
<li>Specific is generally better, since an abstract story doesn't feel as real.</li>
</ul>
</li>
<li><strong>What should I do when I'm trying to be specific but I have to make an arbitrary choice?</strong>
<ul>
<li>Add a FAQ with some of the other alterantives, or just acknowledging that you made an arbitrary choice there.</li>
</ul>
</li>
<li><strong>None of the characters are a fit for my story.</strong>
<ul>
<li>It doesn't have to be perfect. Pick the one that seems like the closest fit. If you really feel stuck, though, come talk to us on <a href="vision/how_to_vision/../../welcome.html#Zulip">Zulip</a> about it!</li>
</ul>
</li>
<li><strong>How should I describe the &quot;evidence&quot; for my status quo story?</strong>
<ul>
<li>The more specific you can get, the better. If you can link to tweets or blog posts, that's ideal. You can also add notes into the <a href="vision/how_to_vision/../../conversations.html">conversations</a> folder and link to those. Of course, you should be sure people are ok with that.</li>
</ul>
</li>
</ul>
<h1 id="-how-to-vision-shiny-future-stories"><a class="header" href="#-how-to-vision-shiny-future-stories">❓ How to vision: &quot;Shiny future&quot; stories</a></h1>
<h2 id="-not-time-for-this-yet-"><a class="header" href="#-not-time-for-this-yet-">🛑 Not time for this yet 🛑</a></h2>
<p>We're not ready for this yet! See the <a href="vision/how_to_vision/../how_to_vision.html">how to vision</a> page for details on the phasing.</p>
<h2 id="tldr-1"><a class="header" href="#tldr-1">TL;DR</a></h2>
<p>Just want to get started? Here are quick instructions to get you going:</p>
<ul>
<li><strong>To write your own story:</strong>
<ul>
<li>Create a PR based on the <a href="https://github.com/rust-lang/wg-async-foundations/tree/master/src/vision/shiny_future/template.md">&quot;shiny future&quot; template</a>. </li>
<li>Do not add your file to <a href="https://github.com/rust-lang/wg-async-foundations/blob/master/src/SUMMARY.md"><code>SUMMARY.md</code></a> -- that will create conflicts, we'll do it manually after merging.</li>
</ul>
</li>
</ul>
<h2 id="how-to-open-a-pr-2"><a class="header" href="#how-to-open-a-pr-2">How to open a PR</a></h2>
<p>If you have an idea you'd like to write about, please <a href="https://github.com/rust-lang/wg-async-foundations/tree/master/src/vision/shiny_future/template.md">open a PR using this template</a> and adding a new file into <a href="https://github.com/rust-lang/wg-async-foundations/tree/master/src/vision/shiny_future">the <code>shiny_future</code> directory</a>. Do not add your file to <a href="https://github.com/rust-lang/wg-async-foundations/blob/master/src/SUMMARY.md"><code>SUMMARY.md</code></a>, that will create conflicts. We'll do it after merging.</p>
<h2 id="goals-of-a-shiny-future-pr"><a class="header" href="#goals-of-a-shiny-future-pr">Goals of a shiny future PR</a></h2>
<p>Shiny future PRs &quot;retell&quot; the story from one or more status quo PRs. The story is now taking place 2-3 years in the future, when Async Rust has had the chance to make all sorts of improvements. <strong>Shiny future stories are aspirational:</strong> we don't have to know exactly how they will be achieved yet! (Of course, it never hurts to have a plan too.)</p>
<p>Like <a href="vision/how_to_vision/./status_quo.html">status quo stories</a>, each shiny future story is always presented from the POV of a particular <a href="vision/how_to_vision/../characters.html">character</a>. They should be detailed. Sometimes this will mean you have to make stuff up, like method names or other details -- you can use the FAQ to spell out areas of particular uncertainty.</p>
<h2 id="the-role-of-the-faq-1"><a class="header" href="#the-role-of-the-faq-1">The role of the FAQ</a></h2>
<p>Every shiny future PR includes a FAQ. This FAQ should always include answers to some standard questions:</p>
<ul>
<li>What status quo story or stories are you retelling?
<ul>
<li>Link to the status quo stories here. If there isn't a story that you're retelling, <a href="vision/how_to_vision/./status_quo.html">write it</a>!</li>
</ul>
</li>
<li>What is <a href="vision/how_to_vision/../characters/alan.html">Alan</a> most excited about in this future? Is he disappointed by anything?
<ul>
<li>Think about Alan's top priority (performance) and the expectations he brings (ease of use, tooling, etc). How do they fare in this future?</li>
</ul>
</li>
<li>What is <a href="vision/how_to_vision/../characters/grace.html">Grace</a> most excited about in this future? Is she disappointed by anything?
<ul>
<li>Think about Grace's top priority (memory safety) and the expectations she brings (still able to use all the tricks she knows and loves). How do they fare in this future?</li>
</ul>
</li>
<li>What is <a href="vision/how_to_vision/../characters/niklaus.html">Niklaus</a> most excited about in this future? Is he disappointed by anything?
<ul>
<li>Think about Niklaus's top priority (accessibility) and the expectations he brings (strong community that will support him). How do they fare in this future?</li>
</ul>
</li>
<li>What is <a href="vision/how_to_vision/../characters/barbara.html">Barbara</a> most excited about in this future? Is she disappointed by anything?
<ul>
<li>Think about Barbara's top priority (productivity, maintenance over time) and the expectations she brings (fits well with Rust). How do they fare in this future?</li>
</ul>
</li>
<li>If this is an alternative to another shiny future, which one, and what motivated you to write an alternative?
<ul>
<li>Cite the story. Be specific, but focus on what you like about your version, not what you dislike about the other.</li>
<li>If this is not an alternative, you can skip this one. =)</li>
</ul>
</li>
<li>What <a href="vision/how_to_vision/../projects.html">projects</a> benefit the most from this future?</li>
<li>Are there any <a href="vision/how_to_vision/../projects.html">projects</a> that are hindered by this future?</li>
</ul>
<p>There are also some optional questions:</p>
<ul>
<li>What are the incremental steps towards realizing this shiny future?
<ul>
<li>Talk about the actual work we will do. You can link to <a href="vision/how_to_vision/../design_docs.html">design docs</a> or even add new ones, as appropriate.</li>
<li>You don't have to have the whole path figured out yet!</li>
</ul>
</li>
<li>Does realizing this future require cooperation between many projects?
<ul>
<li>For example, if you are describing an interface in libstd that runtimes will have to implement, talk about that.</li>
</ul>
</li>
</ul>
<p>You can feel free to add whatever other FAQs seem appropriate. You should also expect to grow the FAQ in response to questions that come up on the PR.</p>
<h2 id="the-review-process-1"><a class="header" href="#the-review-process-1">The review process</a></h2>
<p>When you opan a status quo PR, people will start to <a href="vision/how_to_vision/./comment.html">comment</a> on it. These comments should always be constructive. They usually have the form of asking &quot;in this future, what does NAME do when X happens?&quot; or asking you to elaborate on other potential problems that might arise. Ideally, you should respond to every comment in one of two ways:</p>
<ul>
<li>Adjust the story with more details or to correct factual errors.</li>
<li>Add something to the story's FAQ to explain the confusion.
<ul>
<li>If the question is already covered by a FAQ, you can just refer the commenter to that.</li>
</ul>
</li>
</ul>
<p>The goal is that, at the end of the review process, the status quo story has a lot more details that address the major questions people had.</p>
<h2 id="-frequently-asked-questions-1"><a class="header" href="#-frequently-asked-questions-1">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What is the process to propose a shiny future story?</strong>
<ul>
<li>Just open a PR <a href="https://github.com/rust-lang/wg-async-foundations/tree/master/src/vision/shiny_future/template.md">using this template</a>.</li>
<li>Do not add your file to <a href="https://github.com/rust-lang/wg-async-foundations/blob/master/src/SUMMARY.md"><code>SUMMARY.md</code></a>, that will create conflicts. We'll do it after merging.</li>
</ul>
</li>
<li><strong>What character should I use for my shiny future story?</strong>
<ul>
<li>Usually you would use the same character from the status quo story you are retelling.</li>
<li>If for some reason you chose a different character, add a FAQ to explain why.</li>
</ul>
</li>
<li><strong>What do I do if there is no status quo story for my shiny future?</strong>
<ul>
<li><a href="vision/how_to_vision/./status_quo.html">Write the status quo story first!</a></li>
</ul>
</li>
<li><strong>How much detail should I give? How specific should I be?</strong>
<ul>
<li>Detailed is generally better, but only if those details are helpful for understanding the morals of your story.</li>
<li>Specific is generally better, since an abstract story doesn't feel as real.</li>
</ul>
</li>
<li><strong>What do I do when I get to details that I don't know yet?</strong>
<ul>
<li>Take your best guess and add a FAQ explaining which details are still up in the air.</li>
</ul>
</li>
<li><strong>What do I do if I don't know that my idea is technically feasible?</strong>
<ul>
<li>You don't have to know how your idea will work yet. You can add FAQs to try and clarify what parts you do know and what parts still need to be figured out.</li>
</ul>
</li>
<li><strong>What do I do if somebody leaves a comment about how my idea will work and I don't know the answer?</strong>
<ul>
<li>Add it to the FAQ!</li>
</ul>
</li>
</ul>
<h1 id="-how-to-vision-constructive-comments"><a class="header" href="#-how-to-vision-constructive-comments">❓ How to vision: Constructive comments</a></h1>
<p>Figuring out the future is tricky business. We all know the internet is not always a friendly place. We want this discussion to be different.</p>
<h2 id="be-respectful-and-supportive"><a class="header" href="#be-respectful-and-supportive">Be respectful and supportive</a></h2>
<p>Writing a &quot;status quo&quot; or &quot;shiny future&quot; story is an act of bravery and vulnerability. In the status quo, we are asking people to talk about the things that they or others found hard, to admit that they had trouble figuring something out. In the case of the shiny future, we're asking people to put out half-baked ideas so that we can find the seeds that will grow into something amazing. It doesn't take much to make that go wrong.</p>
<h2 id="comment-to-understand-or-improve-not-to-negate-or-dissuade"><a class="header" href="#comment-to-understand-or-improve-not-to-negate-or-dissuade">Comment to understand or improve, not to negate or dissuade</a></h2>
<blockquote>
<p>“Most people do not listen with the intent to understand; they listen with the intent to reply.”</p>
<p>-- <a href="https://www.franklincovey.com/the-7-habits/habit-5/">Stephen Covey</a></p>
</blockquote>
<p>The golden rule is that when you leave a comment, you are looking to understand or improve the story. </p>
<p>For status quo stories, remember that these are true stories about people's experiences -- they can't be <em>wrong</em> (though they could be inaccurate). It may be that somebody tries for days to solve a problem that would've been easy if they had just known to call a particular method. That story is not wrong, it's an opportunity to write a shiny future story in which you explain how they would've learned about that method, or perhaps about how that method would become unnecessary.</p>
<p>For shiny future stories, even if you don't like the idea, you should ask comments with the goal of better understanding what the author likes about it. Understanding that may give you an idea for how to get those same benefits in a way that you are happier with. It's also valid to encourage the author to elaborate on the impact their story will have on different characters.</p>
<h2 id="you-might-just-want-to-write-your-own-story"><a class="header" href="#you-might-just-want-to-write-your-own-story">You might just want to write your own story</a></h2>
<p>Remember, opening your own PR is free (In fact, we're giving an <a href="vision/how_to_vision/./awards.html">award</a> for being &quot;most prolific&quot;). If you find that you had a really different experience than a status quo story, or you have a different idea for a shiny future, consider just writing your own PR instead of commenting negatively on someone else's. The goal of the brainstorming phase is to put a lot of alternatives, so that we can look for opportunities to combine them and make something with the best of both. </p>
<h2 id="good-questions-for-status-quo-stories"><a class="header" href="#good-questions-for-status-quo-stories">Good questions for status quo stories</a></h2>
<p>Here are some examples of good questions for &quot;status quo&quot; stories:</p>
<ul>
<li>Tell me more about this step. What led NAME to do X?</li>
<li>What do you think OTHER_NAME would have done here?</li>
<li>Can you be more specific about this point? What library did they use?</li>
</ul>
<h2 id="good-questions-for-shiny-future-stories"><a class="header" href="#good-questions-for-shiny-future-stories">Good questions for shiny future stories</a></h2>
<p>Here are some examples of good questions for &quot;shiny future&quot; stories:</p>
<ul>
<li>How does NAME do X in this future?</li>
<li>It seems like this would interfere with X, which is important for application A. How would NAME handle that case in this future?</li>
</ul>
<p>You should not be afraid to raise technical concerns -- we need to have a robust technical discussion! But do so in a way that leaves room to find an answer that satisfies both of you.</p>
<h1 id="-how-to-vision-awards"><a class="header" href="#-how-to-vision-awards">❓ How to vision: Awards</a></h1>
<p>At the end of the <a href="vision/how_to_vision/../how_to_vision.html#brainstorming">brainstorming period</a>, we'll also vote on various awards to give to the status quo and shiny future PRs that were submitted. </p>
<h2 id="award-categories"><a class="header" href="#award-categories">Award categories</a></h2>
<p>These are the award categories:</p>
<ul>
<li>Most humorous story</li>
<li>Most creative story</li>
<li>Most supportive -- who left the most helpful comments?</li>
<li>Most prolific -- who wrote the most stories?</li>
<li>Most unexpected -- which status quo story (or shiny future) took you by surprise?</li>
<li>Most painful &quot;status quo&quot; story</li>
<li>Most ambitious &quot;shiny future&quot; story</li>
<li>Most extensive FAQ</li>
</ul>
<p>However, if you have an idea for another award category, we are happy to take suggestions. One rule: the awards can't be negative (e.g., no &quot;most unrealistic&quot;), and they can't be about which thing is &quot;best&quot;. That would work against the brainstorming spirit.</p>
<h2 id="voting"><a class="header" href="#voting">Voting</a></h2>
<p>At the end of the <a href="vision/how_to_vision/../how_to_vision.html#brainstorming">brainstorming period</a>, we're going to have a voting session to select which PRs and people win the awards. The winners will be featured in a blog post. 🏆</p>
<h1 id="-design-tenets-for-async"><a class="header" href="#-design-tenets-for-async">✏️ Design tenets for async</a></h1>
<table><thead><tr><th>Status</th><th>Owner</th></tr></thead><tbody>
<tr><td>⚠️ Draft ⚠️</td><td>nikomatsakis</td></tr>
</tbody></table>
<p><strong>Draft status.</strong> These tenets are a first draft. nikomatsakis plans to incorporate feedback and revise them before they are finalized.</p>
<p>The design tenets describe the key principles that drive our work on async. Hopefully, we are able to achieve and honor all of them all of the time. Sometimes, though, they come into conflict, and we have to pick -- in that case, we prefer the tenet earlier in the list.</p>
<ol>
<li><strong>Minimal overhead.</strong> Rust Async I/O performance should compare favourably with any other language. In the extreme case, it should be possible to use async/await without any required allocation, although this is unlikely to be a common case in production systems.</li>
<li><strong>Easy to get started, but able to do anything you want.</strong> We should make it simple to write Async I/O code and get things that work reasonably well, but it should be possible for people to obtain fine-grained control as needed.</li>
<li><strong>Async is like sync, but with blocking points clearly identified.</strong> At the highest level, writing a simple program using asynchronous I/O in Rust should be analogous to writing one that uses synchronous I/O, except that one adds <code>async</code> in front of function declarations and adds <code>.await</code> after each call. We should aim for analogous design between synchronous and asynchronous equivalents. Similarly, streams should be like asynchronous iterators. One should be able to use the same sort of combinators with streams and to iterate over them in analogous ways.</li>
<li><strong>No one true runtime.</strong> We need to be able to hook into existing runtimes in different environments, from embedded environments to runtimes like node.js. Specialized systems need specialized runtimes. </li>
<li><strong>Library ecosystem is key.</strong> We want to have a strong ecosystem of async crates, utilities, and frameworks. This will require mechanisms to write libraries/utilities/frameworks that are generic and interoperable across runtimes.</li>
</ol>
<h2 id="stress-tests"><a class="header" href="#stress-tests">Stress tests</a></h2>
<p>&quot;Stress tests&quot; are important use cases that tend to &quot;stretch&quot; the design. When we are contemplating changes, it's important to look over the stress tests and make sure that they all still work:</p>
<ul>
<li><strong>Single-threaded executors:</strong> Some systems tie each task to a single thread; such tasks should be able to access data that is not <code>Send</code> or <code>Sync</code>, and the executor for those tasks should be able to be fully optimized to avoid atomic accesses, etc.</li>
<li><strong>Multi-threaded executors:</strong> Many systems migrate tasks between threads transparently, and that should be supported as well, though tasks will be required to be <code>Send</code>.</li>
<li><strong>&quot;Bring your own runtime&quot;:</strong> The Rust language itself should not require that you start threads, use epoll, or do any other particular thing.</li>
<li><strong>Zero allocation, single task:</strong> Embedded systems might want to be able to have a single task that is polled to completion and which does no allocation whatsoever.</li>
<li><strong>Multiple runtimes in one process:</strong> Sometimes people have to combine systems, each of which come with their own event loop. We should avoid assuming there is one global event loop in the system. </li>
<li><strong>Non-Rust based runtimes:</strong> Sometimes people want to integrate into event loops from other, non-Rust-based systems.</li>
<li><strong>WebAssembly in the browser:</strong> We want to integrate with WebAssembly.</li>
</ul>
<h1 id="-cast-of-characters"><a class="header" href="#-cast-of-characters">🙋‍♀️ Cast of characters</a></h1>
<h2 id="what-is-this-1"><a class="header" href="#what-is-this-1">What is this?</a></h2>
<p>We've created four characters that we use to guide our thinking. These characters are the protagonists of our <a href="vision/./status_quo.html">status quo</a> and <a href="vision/./shiny_future.html">shiny future</a> stories, and they help us to think about the different kinds of priorities and expectations that people bring to Async Rust. Having names and personalities also makes the stories more fun and approachable.</p>
<h2 id="the-characters"><a class="header" href="#the-characters">The characters</a></h2>
<ul>
<li><a href="vision/./characters/alan.html">Alan</a>: the experienced &quot;GC'd language&quot; developer, new to Rust
<ul>
<li><em>Top priority</em>: performance -- that's what he is not getting from current GC'd language</li>
<li><em>Expectations</em>: absence of memory safety bugs (he gets that now from his GC), strong ecosystem, great tooling</li>
</ul>
</li>
<li><a href="vision/./characters/grace.html">Grace</a>: the systems programming expert, new to Rust
<ul>
<li><em>Top priority</em>: memory safety -- that's what she is not getting from C/C++</li>
<li><em>Expectations</em>: able to do all the things she's used to from C/C++</li>
</ul>
</li>
<li><a href="vision/./characters/niklaus.html">Niklaus</a>: new programmer from an unconventional background
<ul>
<li><em>Top priority</em>: accessibility -- he's learning a lot of new things at once</li>
<li><em>Expectations</em>: community -- the community enabled him to have early success, and he is excited to have it support him and him grow more</li>
</ul>
</li>
<li><a href="vision/./characters/barbara.html">Barbara</a>: the experienced Rust developer
<ul>
<li><em>Top priority</em>: overall productivity and long-term maintenance -- she loves Rust, and wants to see it extended to new areas; she has an existing code base to maintain</li>
<li><em>Expectations</em>: elegance and craftsmanship, fits well with Rust</li>
</ul>
</li>
</ul>
<h2 id="-frequently-asked-questions-2"><a class="header" href="#-frequently-asked-questions-2">🤔 Frequently Asked Questions</a></h2>
<ul>
<li>Where do the names come from?
<ul>
<li>Famous programming language designers and theorists. <a href="https://en.wikipedia.org/wiki/Alan_Turing">Alan Turing</a>, <a href="https://en.wikipedia.org/wiki/Grace_Hopper">Grace Hopper</a>, <a href="https://en.wikipedia.org/wiki/Niklaus_Wirth">Niklaus Wirth</a>, and <a href="https://en.wikipedia.org/wiki/Barbara_Liskov">Barbara Liskov</a>.</li>
</ul>
</li>
<li>I don't see myself in these characters. What should I do?
<ul>
<li>Come to Zulip and talk to us about it! Maybe they need to be adjusted!</li>
</ul>
</li>
<li>I see myself in more than one of these characters!
<ul>
<li>Yeah, me too.</li>
</ul>
</li>
</ul>
<h1 id="-cast-of-characters-1"><a class="header" href="#-cast-of-characters-1">🙋‍♀️ Cast of characters</a></h1>
<h2 id="alan-the-experienced-gcd-language-developer-new-to-rust"><a class="header" href="#alan-the-experienced-gcd-language-developer-new-to-rust">Alan: the experienced &quot;GC'd language&quot; developer, new to Rust</a></h2>
<h3 id="variant-a-dynamic-languages"><a class="header" href="#variant-a-dynamic-languages">Variant A: Dynamic languages</a></h3>
<p>Alan has been programming for years. He has built systems in Ruby on Rails, node.js, and used Django too. Lately he's been learning Rust and he is tinkering with integrating Rust into some of his projects to get better performance and reliability. He's also building some projects entirely in Rust.</p>
<h3 id="variant-b-java"><a class="header" href="#variant-b-java">Variant B: Java</a></h3>
<p>Alan works at a Java shop. They run a number of network services built in Java, along with some that use Kotlin or Scala. He's very familiar with the Java ecosystem and the tooling that the JVM offers. He's also sometimes had to tweak his code to work around garbage collector latencies or to reduce overall memory usage. He's curious to try porting some systems to Rust to see how it works.</p>
<h3 id="variant-c-kotlin"><a class="header" href="#variant-c-kotlin">Variant C: Kotlin</a></h3>
<p>Alan is developing networking programs in Kotlin. He loves Kotlin for its expressive syntax and clean integration with Java. Still, he sometimes encounters problems running his services due to garbage collection latencies or overall memory usage. He's heard that Rust can be fun to use too, and is curious to try it out.</p>
<h2 id="-frequently-asked-questions-3"><a class="header" href="#-frequently-asked-questions-3">🤔 Frequently Asked Questions</a></h2>
<ul>
<li>What does Alan want most from Async Rust?
<ul>
<li>The promise of better performance and memory usage than the languages he's been using. Rust's safety guarantees are important too; he's considered using C++ in the past but always judged the maintenance burden would be too high.</li>
</ul>
</li>
<li>What expectations does Alan bring from his current environment?
<ul>
<li>A focus on ease of use, a strong ecosystem, and great tooling.</li>
</ul>
</li>
</ul>
<h1 id="-cast-of-characters-2"><a class="header" href="#-cast-of-characters-2">🙋‍♀️ Cast of characters</a></h1>
<h2 id="grace-the-systems-programming-expert-new-to-rust"><a class="header" href="#grace-the-systems-programming-expert-new-to-rust">Grace: the systems programming expert, new to Rust</a></h2>
<p>Grace has been writing C and C++ for a number of years. She's accustomed to hacking lots of low-level details to coax the most performance she can from her code. She's also experienced her share of epic debugging sessions resulting from memory errors in C. She's intrigued by Rust: she likes the idea of getting the same control and performance she gets from C but with the productivity benefits she gets from memory safety. She's currently experimenting with introducing Rust into some of the systems she works on, and she's considering Rust for a few greenfield projects as well.</p>
<h2 id="-frequently-asked-questions-4"><a class="header" href="#-frequently-asked-questions-4">🤔 Frequently Asked Questions</a></h2>
<ul>
<li>What does Grace want most from Async Rust?
<ul>
<li>Grace is most interested in memory safety. She is comfortable with C and C++ but she's also aware of the maintenance burden that arises from the lack of memory safety.</li>
</ul>
</li>
<li>What expectations does Grace bring from her current environment?
<ul>
<li>Grace expects to be able to get the same performance she used to get from C or C++.</li>
<li>Grace is accustomed to various bits of low-level tooling, such as gdb or perf. It's nice if Rust works reasonably well with those tools, but she'd be happy to have access to better alternatives if they were available. She's happy using <code>cargo</code> instead of <code>make</code>, for example.</li>
</ul>
</li>
</ul>
<h1 id="-cast-of-characters-3"><a class="header" href="#-cast-of-characters-3">🙋‍♀️ Cast of characters</a></h1>
<h2 id="niklaus-new-programmer-from-an-unconventional-background"><a class="header" href="#niklaus-new-programmer-from-an-unconventional-background">Niklaus: new programmer from an unconventional background</a></h2>
<p>He's always been interested in programming but doesn't have experience with it. He's been working as a tech writer and decided to dip his toe in by opening PRs to improve the documentation for one of the libraries he was playing with. The feedback was positive so he fixed a small bug. He's now considering getting involved in a deeper way.</p>
<h2 id="-frequently-asked-questions-5"><a class="header" href="#-frequently-asked-questions-5">🤔 Frequently Asked Questions</a></h2>
<ul>
<li>What does Niklaus want most from Async Rust?
<ul>
<li>Niklaus values accessibility. He's learning a lot of new things at once and it can be overwhelming.</li>
</ul>
</li>
<li>What expectations does Niklaus bring from his current environment?
<ul>
<li>Niklaus expects a strong and supportive community. The Rust community enabled him to have early success, and he is excited to have it support him and for it to help him grow more.</li>
</ul>
</li>
</ul>
<h1 id="-cast-of-characters-4"><a class="header" href="#-cast-of-characters-4">🙋‍♀️ Cast of characters</a></h1>
<h2 id="barbara-the-experienced-rust-developer"><a class="header" href="#barbara-the-experienced-rust-developer">Barbara: the experienced Rust developer</a></h2>
<p>Barbara has been using Rust since the 0.1 release. She remembers some of the crazy syntax in Ye Olde Rust of Yore and secretly still misses the <code>alt</code> keyword (don't tell anyone). Lately she's maintaining various projects in the async space.</p>
<h2 id="-frequently-asked-questions-6"><a class="header" href="#-frequently-asked-questions-6">🤔 Frequently Asked Questions</a></h2>
<ul>
<li>What does Barbara want most from Async Rust?
<ul>
<li>She is using Rust for its feeling of productivity, and she expects Async Rust to continue in that tradition.</li>
<li>She maintains several existing projects, so stability is important to her.</li>
</ul>
</li>
<li>What expectations does Barbara bring from her current environment?
<ul>
<li>She wants a design that feels like the rest of Rust.</li>
<li>She loves Rust and she expects Async Rust to share its overall values.</li>
</ul>
</li>
</ul>
<h1 id="-projects"><a class="header" href="#-projects">⚡ Projects</a></h1>
<h2 id="what-is-this-2"><a class="header" href="#what-is-this-2">What is this?</a></h2>
<p>This section describes various sample projects that are referenced in our stories. Each project is meant to represent some domain that we are targeting.</p>
<h2 id="list-of-projects"><a class="header" href="#list-of-projects">List of projects</a></h2>
<p>See the sidebar for the full list.</p>
<h2 id="dont-find-a-project-like-yours-here"><a class="header" href="#dont-find-a-project-like-yours-here">Don't find a project like yours here?</a></h2>
<p>Don't despair! This is just a list of fun projects that we've needed for stories. If you'd like to add a project for your story, feel free to do so! Note though that you may find that some existing project has the same basic characteristics as your project, in which case it's probably better to reuse the existing project.</p>
<h1 id="-projects-name-domain"><a class="header" href="#-projects-name-domain">⚡ Projects: NAME (DOMAIN)</a></h1>
<p><em>This is a template for adding new projects. See the <a href="vision/projects/../how_to_vision/projects.html">instructions</a> for more details on how to add new project!</em></p>
<h2 id="what-is-this-3"><a class="header" href="#what-is-this-3">What is this?</a></h2>
<p>This is a sample project for use within the various <a href="vision/projects/../status_quo.html">&quot;status quo&quot;</a> or <a href="vision/projects/../shiny_future.html">&quot;shiny future&quot;</a> stories.</p>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p><em>Give a fun description of the project here! Include whatever details are needed.</em></p>
<h2 id="-frequently-asked-questions-7"><a class="header" href="#-frequently-asked-questions-7">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What makes this project different from others?</strong></li>
<li><strong>Does this project require a custom tailored runtime?</strong></li>
<li><strong>How much of this project is likely to be built with open source components from crates.io?</strong></li>
<li><strong>What is of most concern to this project?</strong></li>
<li><strong>What is of least concern to this project?</strong></li>
</ul>
<h1 id="-projects-monstermesh-embedded-sensors"><a class="header" href="#-projects-monstermesh-embedded-sensors">⚡ Projects: MonsterMesh (embedded sensors)</a></h1>
<h2 id="what-is-this-4"><a class="header" href="#what-is-this-4">What is this?</a></h2>
<p>This is a sample project for use within the various <a href="vision/projects/../status_quo.html">&quot;status quo&quot;</a> or <a href="vision/projects/../shiny_future.html">&quot;shiny future&quot;</a> stories.</p>
<h2 id="description-1"><a class="header" href="#description-1">Description</a></h2>
<p>&quot;MonsterMesh&quot; is a sensor mesh on microcontrollers using Rust. The nodes communicate wirelessly to relay their results. These sensors are built using very constrained and low power hardware without operating system, so the code is written in a <code>#[no_std]</code> environment and is very careful about available resources.</p>
<h2 id="-frequently-asked-questions-8"><a class="header" href="#-frequently-asked-questions-8">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What makes embedded projects like MonsterMesh different from others?</strong>
<ul>
<li>Embedded developers need to write error-free applications outside of the comfort zone of an operating system. Rust helps to prevent many classes of programming errors at compile time which inspires confidence in the software quality and and cuts time intensive build-flash-test iterations.</li>
<li>Embedded developers needs good hardware abstraction. Frameworks in other languages do not provide the sophisticated memory mapped IO to safe type abstraction tooling which have been created by the Rust teams.</li>
<li>Embedded developers care about hard real time capabilities; the concept of &quot;you only pay for what you use&quot; is very important in embedded applications. The combination of the inherently asynchronous interrupt handling of microcontrollers with the Rust async building blocks are a perfect match to effortlessly create applications with hard realtime capabilities.</li>
<li>Embedded developers are particularly appreciative of strong tooling support. The availability of the full environment via <code>rustup</code> and the integration of the full toolchain with <code>cargo</code> and <code>build.rs</code> make her very happy because she can focus on what she does best instead of having regular fights with the environment.</li>
</ul>
</li>
<li><strong>Does MonsterMesh require a custom tailored runtime?</strong>
<ul>
<li>Yes! The tradeoffs for an embedded application like MonsterMesh and a typical server are very different. Further, most server-grade frameworks are not <code>#[no_std]</code> compatible and far exceeded the available footprint on the sensor nodes.</li>
</ul>
</li>
<li><strong>How much of this project is likely to be built with open source components from crates.io?</strong>
<ul>
<li>Having no operating system to provide abstractions to it, MonsterMesh will contain all the logic it needs to run. Much of this, especially around the hardware-software-interface is unlikely to be unique to MonsterMesh and will be sourced from crates.io. However, the further up the stack one goes, the more specialized the requirements will become.</li>
</ul>
</li>
<li><strong>How did you pick the name?</strong>
<ul>
<li>So glad you asked! Please watch this <a href="https://www.youtube.com/watch?v=vNuVifA7DSU">entertaining video</a>.</li>
</ul>
</li>
</ul>
<h1 id="-projects-distridata-generic-infrastructure"><a class="header" href="#-projects-distridata-generic-infrastructure">⚡ Projects: DistriData (Generic Infrastructure)</a></h1>
<h2 id="what-is-this-5"><a class="header" href="#what-is-this-5">What is this?</a></h2>
<p>This is a sample project for use within the various <a href="vision/projects/../status_quo.html">&quot;status quo&quot;</a> or <a href="vision/projects/../shiny_future.html">&quot;shiny future&quot;</a> stories.</p>
<h2 id="description-2"><a class="header" href="#description-2">Description</a></h2>
<p>DistriData is the latest in containerized, micro-service distributed database technology. Developed completely in the open as part of Cloud Native Computing Foundation, this utility is now deployed in a large portion of networked server applications across the entire industry. Since it's so widely used, DistriData has to balance flexibility with having sensible defaults.</p>
<h2 id="-frequently-asked-questions-9"><a class="header" href="#-frequently-asked-questions-9">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What makes DistriData different from others?</strong>
<ul>
<li>This project is meant to be used in many different ways in many different projects, and is not unique to any one application.</li>
<li>Many of those using this project will not even need or want to know that it's written in Rust.</li>
</ul>
</li>
<li><strong>Does DistriData require a custom tailored runtime?</strong>
<ul>
<li>DistriData's concerns are at a higher level than the runtime. A fast, reliable, and resource conscious general purpose runtime will serve DistriData's needs.</li>
</ul>
</li>
<li><strong>How much of this project is likely to be built with open source components from crates.io?</strong>
<ul>
<li>Yes, while DistriData receives many contributions, it's important to the team that when possible they utilize existing technologies that developers are already familiar with to ensure that contributing to the project is easy.</li>
</ul>
</li>
<li><strong>What is of most concern to this project?</strong>
<ul>
<li>It needs to be resource conscious, fast, reliable, but above all else it needs to be easy to run, monitor, and maintain.</li>
</ul>
</li>
<li><strong>What is of least concern to this project?</strong>
<ul>
<li>While DistriData is resource conscious, it's not resource <em>starved</em>. There's no need to make life difficult to save on a memory allocation here or there.</li>
</ul>
</li>
</ul>
<h1 id="-projects-trafficmonitor-custom-infrastructure"><a class="header" href="#-projects-trafficmonitor-custom-infrastructure">⚡ Projects: TrafficMonitor (Custom Infrastructure)</a></h1>
<h2 id="what-is-this-6"><a class="header" href="#what-is-this-6">What is this?</a></h2>
<p>This is a sample project for use within the various <a href="vision/projects/../status_quo.html">&quot;status quo&quot;</a> or <a href="vision/projects/../shiny_future.html">&quot;shiny future&quot;</a> stories.</p>
<h2 id="description-3"><a class="header" href="#description-3">Description</a></h2>
<p>TrafficMonitor is a utility written by AmoogleSoft, a public cloud provider, for monitoring network traffic as it comes into its data centers to prevent things like distributed denial-of-service attacks. It monitors <em>all</em> network traffic, looking for patterns, and deciding when to take action against certain threat vectors. TrafficMonitor runs across almost all server racks in a data center, and while it does run on top of an operating system, it is resource conscious. It's also extremely important that TrafficMonitor stay running and handle network traffic with as few &quot;hiccups&quot; as possible. TrafficMonitor is highly tuned to the needs of AmoogleSoft's cloud offering and won't run anywhere else.</p>
<h2 id="-frequently-asked-questions-10"><a class="header" href="#-frequently-asked-questions-10">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What makes networking infrastructure projects like TrafficMonitor different from others?</strong>
<ul>
<li>Networking infrastructure powers entire datacenters or even public internet infrastructure, and as such it is imperative that it run without failure.</li>
<li>It is also extremely important that such projects take few resources as possible. Being on an operating system and large server racks <em>may</em> mean that using the standard library is possible, but memory and CPU usage should be kept to a minimum.</li>
<li>This project is worked on by software developers with different backgrounds. Some are networking infrastructure experts (usually using C) while others have experience in networked applications (usually using GCed languages like Java, Go, or Node).</li>
</ul>
</li>
<li><strong>Does TrafficMonitor require a custom tailored runtime?</strong>
<ul>
<li>Maybe? TrafficMonitor runs on top of a full operating system and takes full advantage of that operating systems networking stack. It's possible that a runtime meant for server workloads will work with TrafficMonitor.</li>
</ul>
</li>
<li><strong>How much of this project is likely to be built with open source components from crates.io?</strong>
<ul>
<li>TrafficMonitor is highly specialized to the internal workings of AmoogleSoft's public cloud offering. Thus, &quot;off-the-shelf&quot; solutions will only work if they're highly flexible and highly tuneable. </li>
<li>TrafficMonitor is central to AmoogleSoft's success meaning that getting things &quot;just right&quot; is much more important than having something from crates.io that mostly works but requires little custom tuning.</li>
</ul>
</li>
<li><strong>What is of most concern to this project?</strong>
<ul>
<li>Reliability is the number one concern. This infrastructure is at the core of the business - it needs to work extremely reliable. A close second is being easily monitorible. If something goes wrong, AmoogleSoft needs to know very quickly what the issue is.</li>
<li>AmoggleSoft is a large company with many existing custom tooling for building, monitoring, and deploying its software. TrafficMonitor has to play nicely in a world that existed long before it came around.</li>
</ul>
</li>
<li><strong>What is of least concern to this project?</strong>
<ul>
<li>AmoogleSoft is a large company with time and resources. High-level frameworks that remove control in favor of peak developer productivity is not what they're after. Sure, the easier things are to get working, the better, but that should not be at the sacrifice of control.</li>
</ul>
</li>
</ul>
<h1 id="-projects-youbuy-traditional-server-application"><a class="header" href="#-projects-youbuy-traditional-server-application">⚡ Projects: YouBuy (Traditional Server Application)</a></h1>
<h2 id="what-is-this-7"><a class="header" href="#what-is-this-7">What is this?</a></h2>
<p>This is a sample project for use within the various <a href="vision/projects/../status_quo.html">&quot;status quo&quot;</a> or <a href="vision/projects/../shiny_future.html">&quot;shiny future&quot;</a> stories.</p>
<h2 id="description-4"><a class="header" href="#description-4">Description</a></h2>
<p>YouBuy is a growing e-commerce website that now has millions of users. The team behind YouBuy is struggling to keep up with traffic and keep server costs low. Having originally written YouBuy in a mix of Ruby on Rails and Node, the YouBuy team decides to rewrite many parts of their service in Rust which they've investigated and found to be performant while still allowing for high levels of abstraction they're used to.</p>
<h2 id="-frequently-asked-questions-11"><a class="header" href="#-frequently-asked-questions-11">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What makes YouBuy and other server applications different from others?</strong>
<ul>
<li>Many server applications are written in languages with garbage collectors. Many of the things that Rust forces users to care about are not first order concerns for those working on server applications (e.g., memory management, stack vs heap allocations, etc.). </li>
<li>Many server applications are written in languages without static type checking. The developers of YouBuy don't have much experience with statically typed languages and some of the developers early in their Rust learning journeys expressed frustration that they found it hard to get their programs to compile especially when using async constructs.</li>
</ul>
</li>
<li><strong>Does YouBuy require a custom tailored runtime?</strong>
<ul>
<li>YouBuy should be perfectly fine with a runtime from crates.io. In fact, their concern isn't at the runtime level but at the high-level server framework level.</li>
</ul>
</li>
<li><strong>How much of this project is likely to be built with open source components from crates.io?</strong>
<ul>
<li>YouBuy is in fierce competition with many other e-commerce sites. Therefore, the less that YouBuy engineers have to write themselves, the better. Ideally, YouBuy can focus 100% of its energy on features that differentiate it from its competition and none of its time on tweaking its networking stack.</li>
</ul>
</li>
<li><strong>What is of most concern to this project?</strong>
<ul>
<li>It seems like YouBuy is always on the verge of either becoming the next billion-dollar company with hundreds of millions of users or completely going out of business. YouBuy needs to be able to move fast and focus on the application business logic.</li>
</ul>
</li>
<li><strong>What is of least concern to this project?</strong>
<ul>
<li>Since moving fast is of primary concern, the ins and outs of the underlying networking stack are only of concern when something goes wrong. The hope is that that rarely if ever happens and when it does, it's easy to find the source of the issue.</li>
</ul>
</li>
</ul>
<h1 id="-projects-slow-protocol-implementation"><a class="header" href="#-projects-slow-protocol-implementation">⚡ Projects: SLOW (Protocol implementation)</a></h1>
<h2 id="what-is-this-8"><a class="header" href="#what-is-this-8">What is this?</a></h2>
<p>This is a sample project for use within the various <a href="vision/projects/../status_quo.html">&quot;status quo&quot;</a> or <a href="vision/projects/../shiny_future.html">&quot;shiny future&quot;</a> stories.</p>
<h2 id="description-5"><a class="header" href="#description-5">Description</a></h2>
<p>SLOW is an open source implementation of a fancy new protocol. This protocol uses a mix of TCP and UDP packets and is designed to operate particularly well over high latency, low throughput links.</p>
<h2 id="-frequently-asked-questions-12"><a class="header" href="#-frequently-asked-questions-12">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What makes this project different from others?</strong>
<ul>
<li>SLOW is a library, not an application.</li>
</ul>
</li>
<li><strong>Does this project require a custom tailored runtime?</strong>
<ul>
<li>Ideally, SLOW would be developed in an independent way that permits it to be used across many runtimes in a variety of different environments.</li>
</ul>
</li>
<li><strong>How much of this project is likely to be built with open source components from crates.io?</strong>
<ul>
<li>SLOW builds on other generic libraries available from crates.io. For example, it would like to make use of compression algorithms that others have written, or to use future adapters.</li>
</ul>
</li>
<li><strong>What is of most concern to this project?</strong>
<ul>
<li>Uh, I don't really know! If you develop software like this, maybe open a PR and tell me! --nikomatsakis</li>
</ul>
</li>
<li><strong>What is of least concern to this project?</strong>
<ul>
<li>Uh, I don't really know! If you develop software like this, maybe open a PR and tell me! --nikomatsakis</li>
</ul>
</li>
<li><strong>Why is this called SLOW?</strong>
<ul>
<li>It's like <a href="https://en.wikipedia.org/wiki/QUIC">QUIC</a>, but slow! Get it? Get it? :D</li>
</ul>
</li>
</ul>
<h1 id="-status-quo-stories"><a class="header" href="#-status-quo-stories">😱 Status quo stories</a></h1>
<h2 id="-under-construction-help-needed--1"><a class="header" href="#-under-construction-help-needed--1">🚧 Under construction! Help needed! 🚧</a></h2>
<p>We are still in the process of drafting the vision document. The stories you see on this page are examples meant to give a feeling for how a status quo story looks; you can expect them to change. We encourage you to propose your own by opening a PR -- see the <a href="vision/./how_to_vision.html">&quot;How to vision&quot;</a> page for instructions and details.</p>
<h2 id="what-is-this-9"><a class="header" href="#what-is-this-9">What is this</a></h2>
<p>The &quot;status quo&quot; stories document the experience of using Async Rust today. Each story narrates the challenges encountered by <a href="vision/./characters.html">one of our characters</a> as they try (and typically fail in dramatic fashion) to achieve their goals.</p>
<p>Writing the &quot;status quo&quot; stories helps us to compensate for the <a href="https://en.wikipedia.org/wiki/Curse_of_knowledge">curse of knowledge</a>: the folks working on Async Rust tend to be experts in Async Rust. We've gotten used to the workarounds required to be productive, and we know the little tips and tricks that can get you out of a jam. The stories help us gauge the cumulative impact all the paper cuts can have on someone still learning their way around. This gives us the data we need to prioritize.</p>
<h3 id="based-on-a-true-story"><a class="header" href="#based-on-a-true-story">Based on a true story</a></h3>
<p>These stories may not be true, but they are not fiction. They are based on real-life experiences of actual people. Each story contains a &quot;Frequently Asked Questions&quot; section referencing sources used to create the story. In some cases, it may link to notes or summaries in the <a href="vision/../conversations.html">conversations</a> section, though that is not required. The &quot;Frequently Asked Questions&quot; section also contains a summary of what the &quot;morals&quot; of the story are (i.e., what are the key takeaways), along with answers to questions that people have raised along the way.</p>
<h3 id="the-stories-provide-data-we-use-to-prioritize-not-a-prioritization-itself"><a class="header" href="#the-stories-provide-data-we-use-to-prioritize-not-a-prioritization-itself">The stories provide data we use to prioritize, not a prioritization itself</a></h3>
<p><strong>Just because a user story is represented here doesn't mean we're going to be able to fix it right now.</strong> Some of these user stories will indicate more severe problems than others. As we consider the stories, we'll select some subset to try and address; that choice is reflected in the <a href="vision/./roadmap.html">roadmap</a>.</p>
<h2 id="where-are-the-stories"><a class="header" href="#where-are-the-stories">Where are the stories?</a></h2>
<p>Check the sidebar with the table of contents bar!</p>
<h1 id="-status-quo-stories-template"><a class="header" href="#-status-quo-stories-template">😱 Status quo stories: Template</a></h1>
<p><em>This is a template for adding new &quot;status quo&quot; stories. To propose a new status quo PR, do the following:</em></p>
<ul>
<li><em>Create a new file in the <a href="https://github.com/rust-lang/wg-async-foundations/tree/master/src/vision/status_quo"><code>status_quo</code></a> directory named something like <code>Alan_tries_to_foo.md</code> or <code>Grace_does_bar.md</code>, and start from <a href="https://raw.githubusercontent.com/rust-lang/wg-async-foundations/master/src/vision/status_quo/template.md">the raw source from this template</a>. You can replace all the italicized stuff. :)</em></li>
<li><em>Do not add a link to your story to the <a href="https://github.com/rust-lang/wg-async-foundations/blob/master/src/SUMMARY.md"><code>SUMMARY.md</code></a> file; we'll do it after merging, otherwise there will be too many conflicts.</em></li>
</ul>
<p><em>For more detailed instructions, see the <a href="vision/status_quo/../how_to_vision/status_quo.html">How To Vision: Status Quo</a> page!</em></p>
<p><em>If you're looking for ideas of what to write about, take a look at the <a href="https://github.com/rust-lang/wg-async-foundations/issues?q=is%3Aopen+is%3Aissue+label%3Astatus-quo-story-ideas">open issues</a>. You can also <a href="https://github.com/rust-lang/wg-async-foundations/issues/new?assignees=&amp;labels=good+first+issue%2C+help+wanted%2C+status-quo-story-ideas&amp;template=-status-quo--story-issue.md&amp;title=">open an issue of your own</a> to throw out an idea for others.</em></p>
<h2 id="-warning-draft-status-"><a class="header" href="#-warning-draft-status-">🚧 Warning: Draft status 🚧</a></h2>
<p>This is a draft &quot;status quo&quot; story submitted as part of the brainstorming period. It is derived from real-life experiences of actual Rust users and is meant to reflect some of the challenges that Async Rust programmers face today. </p>
<p>If you would like to expand on this story, or adjust the answers to the FAQ, feel free to open a PR making edits (but keep in mind that, as they reflect peoples' experiences, status quo stories <a href="vision/status_quo/../how_to_vision/comment.html#comment-to-understand-or-improve-not-to-negate-or-dissuade">cannot be wrong</a>, only inaccurate). Alternatively, you may wish to <a href="vision/status_quo/../how_to_vision/status_quo.html">add your own status quo story</a>!</p>
<h2 id="the-story"><a class="header" href="#the-story">The story</a></h2>
<p><em>Write your story here! Feel free to add subsections, citations, links, code examples, whatever you think is best.</em></p>
<h2 id="-frequently-asked-questions-13"><a class="header" href="#-frequently-asked-questions-13">🤔 Frequently Asked Questions</a></h2>
<p><em>Here are some standard FAQ to get you started. Feel free to add more!</em></p>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li><em>Talk about the major takeaways-- what do you see as the biggest problems.</em></li>
</ul>
</li>
<li><strong>What are the sources for this story?</strong>
<ul>
<li><em>Talk about what the story is based on, ideally with links to blog posts, tweets, or other evidence.</em></li>
</ul>
</li>
<li><strong>Why did you choose <em>NAME</em> to tell this story?</strong>
<ul>
<li><em>Talk about the character you used for the story and why.</em></li>
</ul>
</li>
<li><strong>How would this story have played out differently for the other characters?</strong>
<ul>
<li><em>In some cases, there are problems that only occur for people from specific backgrounds, or which play out differently. This question can be used to highlight that.</em></li>
</ul>
</li>
</ul>
<h1 id="-status-quo-stories-alan-runs-into-stack-allocation-trouble"><a class="header" href="#-status-quo-stories-alan-runs-into-stack-allocation-trouble">😱 Status quo stories: Alan runs into stack allocation trouble</a></h1>
<h2 id="-warning-draft-status--1"><a class="header" href="#-warning-draft-status--1">🚧 Warning: Draft status 🚧</a></h2>
<p>This is a draft &quot;status quo&quot; story submitted as part of the brainstorming period. It is derived from real-life experiences of actual Rust users and is meant to reflect some of the challenges that Async Rust programmers face today.</p>
<h2 id="the-problem"><a class="header" href="#the-problem">The problem</a></h2>
<p>One day, as Alan is working on his async Rust project, he runs his application and hits an error:</p>
<pre><code class="language-ignore">$ .\target\debug\application.exe
thread 'main' has overflowed its stack
</code></pre>
<p>Perplexed, Alan sees if anything with his application works by seeing if he can get output when the <code>--help</code> flag is passed, but he has no luck:</p>
<pre><code class="language-ignore">$ .\target\debug\application.exe --help
thread 'main' has overflowed its stack
</code></pre>
<h2 id="searching-for-the-solution"><a class="header" href="#searching-for-the-solution">Searching for the solution</a></h2>
<p>Having really only ever seen stack overflow issues caused by recursive functions, Alan desperately tries to find the source of the bug but searching through the codebase for recursive functions only to find none. Having learned that Rust favors stack allocation over heap allocation (a concept Alan didn't really need to worry about before), he started manually looking through his code, searching for structs that looked &quot;too large&quot;; he wasn't able to find any candidates.</p>
<p>Confused, Alan reached out to Grace for her advice. She suggested making the stack size larger. Although she wasn't a Windows expert, she remembers hearing that stack sizes on Windows might be smaller than on Linux. After much searching, Alan discovers an option do just that: <code>RUSTFLAGS = &quot;-C link-args=-Wl,-zstack-size=&lt;size in bytes&gt;&quot;</code>.</p>
<p>While eventually Alan gets the program to run, the stack size must be set to 4GB before it does! This seems untenable, and Alan goes back to the drawing board.</p>
<p>Alan reaches out to Barbara for her expertise in Rust to see if she has something to suggest. Barbara recommends using <code>RUSTFLAGS = &quot;-Zprint-type-sizes</code> to print some type sizes and see if anything jumps out. Barbara noted that if Alan does find a type that stands out, it's usually as easy as putting some boxes in that type to provide some indirection and not have everything be stack allocated. Alan never needs the nightly toolchain, but this option requires it so he installs it using <code>rustup</code>. After searching through types, one did stand out as being quite large. Ultimately, this was a red herring, and putting parts of it in <code>Box</code>es did not help.</p>
<h2 id="finding-the-solution"><a class="header" href="#finding-the-solution">Finding the solution</a></h2>
<p>After getting no where, Alan went home for the weekend defeated. On Monday, he decided to take another look. One piece of code, stuck out to him: the use of the <code>select!</code> macro from the <code>futures</code> crate. This macro allowed multiple futures to race against each other, returning the value of the first one to finish. This macro required the futures to be pinned which the docs had shown could be done by using <code>pin_mut!</code>. Alan didn't fully grasp what <code>pin_mut!</code> was actually doing when he wrote that code. The compiler had complained to him that the futures he was passing to <code>select!</code> needed to be pinned, and <code>pin_mut!</code> was what he found to make the compiler happy.</p>
<p>Looking back at the documents made it clear to Alan that this could potentially be the issue: <code>pin_mut!</code> pins futures to the stack. It was relatively clear that a possible solution would be to pin to the heap instead of the stack. Some more digging in the docs lead Alan to <code>Box::pin</code> which did just that. An extra heap allocation was of no consequence to him, so he gave it a try. Lo and behold, this fixed the issue! </p>
<p>While Alan knew enough about pinning to know how to satisfy the compiler, he didn't originally take the time to fully understand what the consequences were of using <code>pin_mut!</code> to pin his futures. Now he knows!</p>
<h2 id="-frequently-asked-questions-14"><a class="header" href="#-frequently-asked-questions-14">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>When coming from a background of GCed languages, taking the time to understand the allocation profile of a particular piece of code is not something Alan was used to doing.</li>
<li>It was hard to tell where in his code the stack was being exhausted. Alan had to rely on manually combing his code to find the culprit.</li>
<li>Pinning is relatively confusing, and although the code compiled, Alan didn't fully understand what he wrote and what consequences his decision to use <code>pin_mut!</code> would have.</li>
</ul>
</li>
<li><strong>What are the sources for this story?</strong>
<ul>
<li>This story is adapted from the experiences of the team working on the <a href="https://github.com/deislabs/krustlet">Krustlet</a> project. You can read about this story in their own words <a href="https://deislabs.io/posts/a-heaping-helping-of-stacks/">here</a>.</li>
</ul>
</li>
<li><strong>Why did you choose Alan to tell this story?</strong>
<ul>
<li>The programmers this story was based on have an experience mostly in Go, a GCed language.</li>
<li>The story is rooted in the explicit choice of using stack vs heap allocation, a choice that in GCed languages is not in the hands of the programmer.</li>
</ul>
</li>
<li><strong>How would this story have played out differently for the other characters?</strong>
<ul>
<li>Grace would have likely had a similar hard time with this bug. While she's used to the tradeoffs of stack vs heap allocations, the analogy to the <code>Pin</code> API is not present in languages she's used to.</li>
<li>Barbara, as an expert in Rust, may have had the tools to understand that <code>pin_mut</code> is used for pinning to the stack while <code>Box::pin</code> is for pinning heap allocations.</li>
<li>This problem is somewhat subtle, so someone like Niklaus would probably have had a much harder time figuring this out (or even getting the code to compile in the first place).</li>
</ul>
</li>
<li><strong>Could Alan have used another API to achieve the same objectives?</strong>
<ul>
<li>Perhaps! Tokio's <code>select!</code> macro doesn't require explicit pinning of the futures it's provided, but it's unclear to this author whether it would have been smart enough to avoid pinning large futures to the stack. However, pinning is a part of the way one uses futures in Rust, so it's possible that such an issue would have arisen elsewhere.</li>
</ul>
</li>
</ul>
<h1 id="-status-quo-stories-alan-hates-writing-a-stream"><a class="header" href="#-status-quo-stories-alan-hates-writing-a-stream">😱 Status quo stories: Alan hates writing a <code>Stream</code></a></h1>
<h2 id="-warning-draft-status--2"><a class="header" href="#-warning-draft-status--2">🚧 Warning: Draft status 🚧</a></h2>
<p>This is a draft &quot;status quo&quot; story submitted as part of the brainstorming period. It is derived from real-life experiences of actual Rust users and is meant to reflect some of the challenges that Async Rust programmers face today. </p>
<p>If you would like to expand on this story, or adjust the answers to the FAQ, feel free to open a PR making edits (but keep in mind that, as they reflect peoples' experiences, status quo stories <a href="vision/status_quo/../how_to_vision/comment.html#comment-to-understand-or-improve-not-to-negate-or-dissuade">cannot be wrong</a>, only inaccurate). Alternatively, you may wish to <a href="vision/status_quo/../how_to_vision/status_quo.html">add your own status quo story</a>!</p>
<h2 id="the-story-1"><a class="header" href="#the-story-1">The story</a></h2>
<p><a href="vision/status_quo/../characters/alan.html">Alan</a> is used to writing web server applications using async sockets, but wants to try Rust to get that signature vroom vroom.</p>
<p>After a couple weeks learning Rust basics, Alan quickly understands <code>async</code> and <code>await</code>, and therefore has several routes built for his application that await a few things and then construct an HTTP response and send a buffered body. To build the buffered response bodies, Alan was reading a file, and then appending a signature, and putting that all into a single buffer of bytes.</p>
<p>Eventually, Alan realizes that some responses have enormous bodies, and would like to stream them instead of buffering them fully in memory. He's <em>used</em> the <code>Stream</code> trait before. Using it was very natural, and followed a similar pattern to regular <code>async</code>/<code>await</code>:</p>
<pre><code class="language-rust ignore">while let Some(chunk) = body.next().await? {
    file.write_all(&amp;chunk).await?;
}
</code></pre>
<p>However, <em>implementing</em> <code>Stream</code> turns out to be rather different. With a quick search, he learned the simple way to turn a <code>File</code> into a <code>Stream</code> with <code>ReaderStream</code>, but the signing part was much harder.</p>
<h3 id="imperatively-wrong"><a class="header" href="#imperatively-wrong">Imperatively Wrong</a></h3>
<p>Alan first hoped he could simply write signing stream imperatively, reusing his new knowledge of <code>async</code> and <code>await</code>, and assuming it'd be similar to JavaScript:</p>
<pre><code class="language-rust ignore">async* fn sign(file: ReaderStream) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {
    let mut sig = Signature::new();

    while let Some(chunk) = file.next().await? {
        sig.push(&amp;chunk);
        yield Ok(chunk)
    }

    yield Ok(sig.digest().await)
}
</code></pre>
<p>Unfortunately, that doesn't work. The compiler first complains about the <code>async* fn</code> syntax:</p>
<pre><code class="language-notrust">error: expected item, found keyword `async`
  --&gt; src/lib.rs:21:1
   |
21 | async* fn sign(file: ReaderStream) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {
   | ^^^^^ expected item
</code></pre>
<p>Less hopeful, Alan tries just deleting the asterisk:</p>
<pre><code class="language-notrust">error[E0658]: yield syntax is experimental
  --&gt; src/lib.rs:27:9
   |
27 |         yield Ok(chunk)
   |         ^^^^^^^^^^^^^^^
   |
   = note: see issue #43122 &lt;https://github.com/rust-lang/rust/issues/43122&gt; for more information
</code></pre>
<p>After reading about how yield is experimental, and giving up reading the 100+ comments in the <a href="https://github.com/rust-lang/rust/issues/43122">linked issue</a>, Alan figures he's just got to implement <code>Stream</code> manually.</p>
<h3 id="implementing-stream"><a class="header" href="#implementing-stream">Implementing <code>Stream</code></a></h3>
<p>Implementing a <code>Stream</code> means writing async code in a way that doesn't <em>feel</em> like the <code>async fn</code> that Alan has written so far. He needs to write a <code>poll</code> function and it has a lot of unfamiliar concepts:</p>
<ul>
<li><code>Pin</code></li>
<li>State machines</li>
<li><code>Wakers</code></li>
</ul>
<p>Unsure of what the final code will look like, he starts with:</p>
<pre><code class="language-rust ignore">struct SigningFile;

impl Stream for SigningFile {
    type Item = Result&lt;Vec&lt;u8&gt;, Error&gt;;
    
    fn poll_next(self: Pin&lt;&amp;mut Self&gt;, cx: &amp;mut Context)
        -&gt; Poll&lt;Self::Item&gt;
    {
 
    }
}
</code></pre>
<h3 id="pin-scream"><a class="header" href="#pin-scream">Pin :scream:</a></h3>
<p>First, he notices <code>Pin</code>. Alan wonders, &quot;Why does <code>self</code> have bounds? I've only ever seen <code>self</code>, <code>&amp;self</code>, and <code>&amp;mut self</code> before&quot;. Curious, he reads the <a href="https://doc.rust-lang.org/std/pin/struct.Pin.html"><code>std::pin</code></a> page, and a bunch of jargon about pinning data in memory. He also reads that this is useful to guarantee that an object cannot move, and he wonders why he cares about that. The only example on the page explains how to write a <a href="https://doc.rust-lang.org/std/pin/index.html#example-self-referential-struct">&quot;self-referential struct&quot;</a>, but notices it needs <code>unsafe</code> code, and that triggers an internal alarm in Alan: &quot;I thought Rust was safe...&quot;</p>
<p>After asking <a href="vision/status_quo/../characters/barbara.html">Barbara</a>, Alan realizes that the types he's depending on are <code>Unpin</code>, and so he doesn't need to worry about the unsafe stuff. It's just a more-annoying pointer type.</p>
<h3 id="state-machine"><a class="header" href="#state-machine">State Machine</a></h3>
<p>With <code>Pin</code> hopefully ignored, Alan next notices that in the imperative style he wanted originally, he didn't need to explicitly keep track of state. The state was simply the imperative order of the function. But in a <code>poll</code> function, the state isn't saved by the compiler. Alan finds blog posts about the dark ages of Futures 0.1, when it was more common for manual <code>Future</code>s to be written with a &quot;state machine&quot;.</p>
<p>He thinks about his stream's states, and settles on the following structure:</p>
<pre><code class="language-rust ignore">struct SigningFile {
    state: State,
    file: ReaderStream,
    sig: Signature,
}

enum State {
    File,
    Sign,
}
</code></pre>
<p>It turns out it was more complicated than Alan thought (the author made this same mistake). The <code>digest</code> method of <code>Signature</code> is <code>async</code>, <em>and</em> it consumes the signature, so the state machine needs to be adjusted. The signature needs to be able to be moved out, and it needs to be able to store a future from an <code>async fn</code>. Trying to figure out how to represent that in the type system was difficult. He considered adding a generic <code>T: Future</code> to the <code>State</code> enum, but then wasn't sure what to set that generic to. Then, he tries just writing <code>Signing(impl Future)</code> as a state variant, but that triggers a compiler error that <code>impl Trait</code> isn't allowed outside of function return types. Patient <a href="vision/status_quo/../characters/barbara.html">Barbara</a> helped again, so that Alan learns to just store a <code>Pin&lt;Box&lt;dyn Future&gt;&gt;</code>, wondering if the <code>Pin</code> there is important.</p>
<pre><code class="language-rust ignore">struct SigningFile {
    state: State,
}

enum State {
    File(ReaderStream, Signature),
    Signing(Pin&lt;Box&lt;dyn Future&lt;Output = Vec&lt;u8&gt;&gt;&gt;&gt;),
    Done,
}
</code></pre>
<p>Now he tries to write the <code>poll_next</code> method, checking readiness of individual steps (thankfully, Alan remembers <code>ready!</code> from the futures 0.1 blog posts he read) and proceeding to the next state, while grumbling away the weird <code>Pin</code> noise:</p>
<pre><code class="language-rust ignore">match self.state {
    State::File(ref mut file, ref mut sig) =&gt; {
        match ready!(Pin::new(file).poll_next(cx)) {
            Some(result) =&gt; {
                let chunk = result?;
                sig.push(&amp;chunk);
                Poll::Ready(Some(Ok(chunk)))
            },
            None =&gt; {
                let sig = match std::mem::replace(&amp;mut self.state, State::Done) {
                    State::File(_, sig) =&gt; sig,
                    _ =&gt; unreachable!(),
                };
                self.state = State::Signing(Box::pin(sig.digest()));
                Poll::Pending
            }
        }
    },
    State::Signing(ref mut sig) =&gt; {
        let last_chunk = ready!(sig.as_mut().poll(cx));
        self.state = State::Done;
        Poll::Ready(Some(Ok(last_chunk)))
    }
    State::Done =&gt; Poll::Ready(None),
}
</code></pre>
<p>Oh well, at least it <em>works</em>, right?</p>
<h3 id="wakers"><a class="header" href="#wakers">Wakers</a></h3>
<p>So far, Alan hasn't paid too much attention to <code>Context</code> and <code>Poll</code>. It's been fine to simply pass them along untouched. There's a confusing bug in his state machine. Let's look more closely:</p>
<pre><code class="language-rust ignore">// zooming in!
match ready!(Pin::new(file).poll_next(cx)) {
    Some(result) =&gt; {
        let chunk = result?;
        sig.push(&amp;chunk);
        return Poll::Ready(Some(Ok(val));
    },
    None =&gt; {
        self.set_state_to_signing();
        // oops!
        return Poll::Pending;
    }
}
</code></pre>
<p>In one of the branches, the state is changed, and <code>Poll::Pending</code> is returned. Alan assumes that the task will be polled again with the new state. But, since the file was done (and has returned <code>Poll::Ready</code>), there was actually no waker registered to wake the task again. So his stream just hangs forever.</p>
<p>The compiler doesn't help at all, and he re-reads his code multiple times, but because of this easy-to-misunderstand logic error, Alan eventually has to ask for help in a chat room. After a half hour of explaining all sorts of details, a kind person points out he either needs to register a waker, or perhaps use a loop.</p>
<p>All too often, since we don't want to duplicate code in multiple branches, the solution for Alan is to add an odd <code>loop</code> around the whole thing, so that the next match branch uses the <code>Context</code>:</p>
<pre><code class="language-rust ignore">loop {
    match self.state {
        State::File(ref mut file, ref mut sig) =&gt; {
            match ready!(Pin::new(file).poll_next(cx)) {
                Some(result) =&gt; {
                    let chunk = result?;
                    sig.push(&amp;chunk);
                    return Poll::Ready(Some(Ok(chunk)))
                },
                None =&gt; {
                    let sig = match std::mem::replace(&amp;mut self.state, State::Done) {
                        State::File(_, sig) =&gt; sig,
                        _ =&gt; unreachable!(),
                    };
                    self.state = State::Signing(Box::pin(sig.digest()));
                    // loop again, to catch the `State::Signing` branch
                }
            }
        },
        State::Signing(ref mut sig) =&gt; {
            let last_chunk = ready!(sig.as_mut().poll(cx));
            self.state = State::Done;
            return Poll::Ready(Some(Ok(last_chunk)))
        }
        State::Done =&gt; return Poll::Ready(None),
    }
}
</code></pre>
<h3 id="gives-up"><a class="header" href="#gives-up">Gives Up</a></h3>
<p>A little later, Alan needs to add some response body transforming to some routes, to add some app-specific framing. Upon realizing he needs to implement another <code>Stream</code> in a generic fashion, he instead closes the editor and complains on Twitter.</p>
<h2 id="-frequently-asked-questions-15"><a class="header" href="#-frequently-asked-questions-15">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>Writing an async <code>Stream</code> is drastically different than writing an <code>async fn</code>.</li>
<li>The documentation for <code>Pin</code> doesn't provide much practical guidance in how to use it, instead focusing on more abstract considerations.</li>
<li>Missing a waker registration is a runtime error, and very hard to debug. If it's even possible, a compiler warning or hint would go a long way.</li>
</ul>
</li>
<li><strong>What are the sources for this story?</strong>
<ul>
<li>Part of this story is based on the original motivation for <code>async</code>/<code>await</code> in Rust, since similar problems exist writing <code>impl Future</code>.</li>
</ul>
</li>
<li><strong>Why did you choose <a href="vision/status_quo/../characters/alan.html">Alan</a> to tell this story?</strong>
<ul>
<li>Choosing Alan was somewhat arbitrary, but this does get to reuse the experience that Alan may already have around <code>await</code> coming from JavaScript.</li>
</ul>
</li>
<li><strong>How would this story have played out differently for the other characters?</strong>
<ul>
<li>This likely would have been a similar story for any character.</li>
<li>It's possible <a href="vision/status_quo/../characters/grace.html">Grace</a> would be more used to writing state machines, coming from C.</li>
</ul>
</li>
</ul>
<h1 id="-status-quo-stories-alan-started-trusting-the-rust-compiler-but-then-async"><a class="header" href="#-status-quo-stories-alan-started-trusting-the-rust-compiler-but-then-async">😱 Status quo stories: Alan started trusting the Rust compiler, but then... async</a></h1>
<h2 id="-warning-draft-status--3"><a class="header" href="#-warning-draft-status--3">🚧 Warning: Draft status 🚧</a></h2>
<p>This is a draft &quot;status quo&quot; story submitted as part of the brainstorming period. It is derived from real-life experiences of actual Rust users and is meant to reflect some of the challenges that Async Rust programmers face today. </p>
<h2 id="the-story-2"><a class="header" href="#the-story-2">The story</a></h2>
<h3 id="trust-the-compiler"><a class="header" href="#trust-the-compiler">Trust the compiler</a></h3>
<p>Alan has a lot of experience in C#, but in the meantime has created some successful projects in Rust.
He has dealt with his fair share of race conditions/thread safety issues during runtime in C#, but is now starting to trust that if his Rust code compiles,
he won't have those annoying runtime problems to deal with.</p>
<p>This allows him to try to squeeze his programs for as much performance as he wants, because the compiler will stop him when he tries things that could result in runtime problems.
After seeing the perfomance and the lack of runtime problems, he starts to trust the compiler more and more with each project finished.</p>
<p>He knows what he can do with external libraries, he does not need to fear concurrency issues if the library cannot be used from multiple threads, because the compiler would tell him.</p>
<p>His trust in the compiler solidifies further the more he codes in Rust.</p>
<h3 id="the-first-async-project"><a class="header" href="#the-first-async-project">The first async project</a></h3>
<p>Alan now starts with his first async project. He sees that there is no async in the standard library, but after googling for &quot;rust async file open&quot;, he finds 'async_std', a crate that provides some async versions of the standard library functions.
He has some code written that asynchrously interacts with some files:</p>
<pre><code class="language-rust ignore">use async_std::fs::File;
use async_std::prelude::*;

fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::create(&quot;a.txt&quot;).await?;
    file.write_all(b&quot;Hello, world!&quot;).await?;
    Ok(())
}
</code></pre>
<p>But now the compiler complains that <code>await</code> is only allowed in <code>async</code> functions. He now notices that all the examples use <code>#[async_std::main]</code> 
as an attribute on the <code>main</code> function in order to be able to turn it into an <code>async main</code>, so he does the same to get his code compiling:</p>
<pre><code class="language-rust ignore">use async_std::fs::File;
use async_std::prelude::*;

#[async_std::main]
async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::create(&quot;a.txt&quot;).await?;
    file.write_all(b&quot;Hello, world!&quot;).await?;

    Ok(())
}
</code></pre>
<p>This aligns with what he knows from C#, where you also change the entry point of the program to be async, in order to use <code>await</code>.
Everything is great now, the compiler is happy, so no runtime problems, so Alan is happy.</p>
<p>The project is working like a charm.</p>
<h3 id="fractured-futures-fractured-trust"><a class="header" href="#fractured-futures-fractured-trust">Fractured futures, fractured trust</a></h3>
<p>The project Alan is building is starting to grow, and he decides to add a new feature that needs to make some API calls. He starts using <code>reqwest</code> in order to help him achieve this task.
After a lot of refactoring to make the compiler accept the program again, Alan is satisfied that his refactoring is done.
His program now boils down to:</p>
<pre><code class="language-rust ignore">use async_std::fs::File;
use async_std::prelude::*;

#[async_std::main]
async fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    let mut file = File::create(&quot;a.txt&quot;).await?;
    file.write_all(b&quot;Hello, world!&quot;).await?;

    let body = reqwest::get(&quot;https://www.rust-lang.org&quot;)
        .await?
        .text()
        .await?;
    println!(&quot;{}&quot;, body);

    Ok(())
}
</code></pre>
<p>He runs his project but is suddenly greeted with a runtime error. He is quite surprised. &quot;How is this even possible?&quot;, he thinks. &quot;I don't have any out-of-bounds accesses, and I never use <code>.unwrap</code> or <code>.expect</code>.&quot;
At the top of the error message he sees: <code>thread 'main' panicked at 'there is no reactor running, must be called from the context of a Tokio 1.x runtime'</code> </p>
<p>He searches what &quot;Tokio&quot; is in Rust, and he finds that it also provides an attribute to put on <code>main</code>, namely <code>[tokio::main]</code>, but what is the difference with <code>[async_std::main]</code>? His curiosity leads him to watch videos/read blogs/scour reddit,... on why there are multiple runtimes in Rust. This leads him into a rabbit hole and now he learns about Executors, Wakers, <code>Pin</code>,... He has a basic grasp of what they are, but does not have a good understanding of them or how they all fit together exactly. These are all things he had not need to know nor heed in C#. (Note: there is another story about troubles/confusion that might arise when learning all these things about async: <a href="vision/status_quo/./alan_hates_writing_a_stream.html">Alan hates writing a <code>Stream</code></a>)</p>
<p>He does understand the current problems and why there is no one-size-fits-all executor (yet). Trying to get his async Rust code to work, he broadened his knowledge about what async code actually is, he gains another way to reason about asynchronous code, not only in Rust, but also more generally.</p>
<p>But now he realizes that there is a whole new area of runtime problems that he did not have to deal with in C#, but he does in Rust.
Can he even trust the Rust compiler anymore? What other kinds of runtime problems can occur in Rust that can't in C#?
If his projects keep increasing in complexity, will other new kinds of runtime problems keep popping up? Maybe it's better to stick with C#, since Alan 
already knows all the runtime problems you can have over there.</p>
<h3 id="the-spider-man-effect"><a class="header" href="#the-spider-man-effect">The Spider-Man effect</a></h3>
<p>Do you recall in Spider-Man, that after getting bitten by the radioactive spider, Peter first gets ill before he gains his powers? Well, imagine instead of being bitten by a radioactive spider, he was bitten by an async-rust spider...</p>
<p>In his work, Alan sees an async call to a C# wrapper around SQLite, his equivalent of a spider-sense (async-sense?) starts tingling. Now knowing from Rust the complexities that arise when trying to create asynchronicity, what kind of complex mechanisms are at play here to enable these async calls from C# that end up in the C/C++ of SQLite?</p>
<p>He quickly discovers that there are no complex mechanism at all! It's actually just a synchronous call all the way down, with just some exta overhead from wrapping it into an asynchronous function. There are no points where the async function will yield. He transforms all these asynchronous calls to their synchronous counterparts, and sees a slight improvement in performance. Alan is happy, product management is happy, customers are happy!</p>
<p>Over the next few months, he often takes a few seconds to reflect about why certain parts of the code are async, if they should be, or how other parts of the code might benefit from being async and if it's possible to make them async. He also uses what he learned from async Rust in his C# code reviews to find similar problems or general issues (With great power...). He even spots some lifetime bugs w.r.t. asynchronous code in C#, imagine that.</p>
<p>His team recognizes that Alan has a pretty good grasp about what async is really about, and he is unofficially crowned the &quot;async guru&quot; of the team.</p>
<p>Even though this spider-man might have gotten &quot;ill&quot; (his negative experience with async Rust), he has now become the superhero he was meant to be!</p>
<h2 id="-frequently-asked-questions-16"><a class="header" href="#-frequently-asked-questions-16">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>Async I/O includes a new set of runtime errors and misbehaviors that the compiler can't help you find. These include cases like executing blocking operations
in an async context but also mixing runtime libraries (something users may not even realize is a factor).</li>
<li>Rust users get used to the compiler giving them error messages for runtime problems but also helping them to fix them. Pushing error messages to runtimes
feels surprising and erodes some of their confidence in Rust.</li>
<li>The &quot;cliff&quot; in learning about async is very steep -- at first everything seems simple and similar to other languages, then suddenly you are thrown into a lot of information. It's hard to know what's important and what is not. <strong>But</strong>, at the same time, dipping your toes into async Rust can broaden the understanding a programmer has of asynchronous coding, which can help them even in other languages than Rust.</li>
</ul>
</li>
<li><strong>What are the sources for this story?</strong>
<ul>
<li>Personal experience of the author.</li>
</ul>
</li>
<li><strong>Why did you choose Alan to tell this story?</strong>
<ul>
<li>With his experience in C#, Alan probably has experience with async code. Even though C# protects him from certain classes of errors,
he can still encounter other classes of errors, which the Rust compiler prevents.</li>
</ul>
</li>
<li><strong>How would this story have played out differently for the other characters?</strong>
<ul>
<li>For everyone except Barbara, I think these would play out pretty similarly, as this is a kind of problem unique to Rust. Since Barbara has a lot of Rust experience,
she would probably already be familiar with this aspect.</li>
</ul>
</li>
<li><strong>How would this story have played out differently if Alan came from another GC'd language?</strong>
<ul>
<li>It would be very close, since all other languages (that I know of) provide async runtimes out of the box and it's not something the programmer needs to concern themselves with.</li>
</ul>
</li>
</ul>
<h1 id="-status-quo-stories-barbara-makes-their-first-foray-into-async"><a class="header" href="#-status-quo-stories-barbara-makes-their-first-foray-into-async">😱 Status quo stories: Barbara makes their first foray into async</a></h1>
<h2 id="-warning-draft-status--4"><a class="header" href="#-warning-draft-status--4">🚧 Warning: Draft status 🚧</a></h2>
<p>This is a draft &quot;status quo&quot; story submitted as part of the brainstorming period. It is derived from real-life experiences of actual Rust users and is meant to reflect some of the challenges that Async Rust programmers face today.</p>
<h2 id="barbaras-first-big-project-in-rust-a-journey-marred-by-doubt"><a class="header" href="#barbaras-first-big-project-in-rust-a-journey-marred-by-doubt">Barbara's first big project in Rust: a journey marred by doubt</a></h2>
<p>It's Barbara's last year at their university and for their master's thesis, they have chosen to create a distributed database.
They have chosen to use their favorite language, Rust, because Rust is a suitable language for low latency applications that they have found very pleasant to work in.
Their project presents quite a challenge since they have only written some small algorithms in Rust, and it's also their first foray into creating a big distributed system.</p>
<h3 id="deciding-to-use-async"><a class="header" href="#deciding-to-use-async">Deciding to use Async</a></h3>
<p>Up until now, Barbara has followed the development of Async from afar by reading the occasional Boats blog post, and celebrating the release announcements with the rest of the happy community.
Due to never having worked with async in other languages, and not having had a project suitable for async experimentation, their understanding of async and its ecosystem remained superficial.
However, since they have heard that async is suitable for fast networked applications, they decide to try using async for their distributed database.
After all, a fast networked application is exactly what they are trying to make.</p>
<p>To further solidify the decision of using async, Barbara goes looking for some information and opinions on async in Rust. Doubts created by reading some tweets about how most people should be using threads instead of async for simplicity reasons are quickly washed away by helpful conversations on the Rust discord.</p>
<h3 id="learning-about-async"><a class="header" href="#learning-about-async">Learning about Async</a></h3>
<p>Still enarmored with the first edition of the Rust book, they decide to go looking for an updated version, hoping that it will teach them async in the same manner that it taught them so much about the language and design patterns for Rust. Disappointed, they find no mention of async in the book, aside from a note that it exists as a keyword.</p>
<p>Not to be deterred, they go looking further, and start looking for similarly great documentation about async.
After stumbling upon the async book, their disappointment is briefly replaced with relief as the async book does a good job at solidifying what they have already learned in various blog posts about async, why one would use it and even a bit about how it all works under the hood.
They skim over the parts that seem a bit too in-depth for now like pinning, as they're looking to quickly get their hands dirty.
Chapter 8: The Async Ecosystem teaches them what they already picked up on through blog posts and contentious tweets: the choice of the runtime has large implications on what libraries they can use.</p>
<h3 id="the-wrong-time-for-big-decisions"><a class="header" href="#the-wrong-time-for-big-decisions">The wrong time for big decisions</a></h3>
<p>Barbara's dreams to quickly get their hands dirty with async Rust are shattered as they discover that they first need to make a big choice: what executor to use. Having had quite a bit of exposure to the conversations surrounding the incompatible ecosystems, Barbara is perhaps a bit more paranoid about making the wrong choice than the average newcomer.
This feels like a big decision to them, as it would influence the libraries they could use and switching to a different ecosystem would be all but impossible after a while. Since they would like to choose what libraries they use before having to choose an executor, Barbara feels like the decision-making is turned on its head. </p>
<p>Their paranoia about choosing the right ecosystem is eased after a few days of research, and some more conversations on the Rust subreddit, after which they discover that most of the RPC libraries they might want to use are situated within the most popular Tokio ecosystem anyways. Tokio also has a brief tutorial, which teaches them some basic concepts within Tokio and talks a bit more about async in general.</p>
<h3 id="woes-of-a-newcomer-to-async"><a class="header" href="#woes-of-a-newcomer-to-async">Woes of a newcomer to async</a></h3>
<p>Being reasonably confident in their choice of ecosystem, Barbara starts building their distributed system.
After a while, they want to introduce another networking library of which the api isn't async. Luckily Barbara picked up on that blocking was not allowed in async (or at least not in any of the currently existing executors), through reading some blog posts about async. More reddit discussions point them towards spawn_blocking in Tokio, and even rayon. But they're none the wiser about how to apply these paradigms in a neat manner.</p>
<p>Previously the design patterns learned in other languages, combined with the patterns taught in the book, were usually sufficient to come to reasonably neat designs.
But neither their previous experience, nor the async book nor the Tokio tutorial were of much use when trying to neatly incorporate blocking code into their previously fully async project.</p>
<h3 id="confused-ever-after"><a class="header" href="#confused-ever-after">Confused ever after</a></h3>
<p>To this day the lack of a blessed approach leaves Barbara unsure about the choices they've made so far and misconceptions they might still have, evermore wondering if the original tweets they read about how most people should just stick to threads were right all along.</p>
<h2 id="-frequently-asked-questions-17"><a class="header" href="#-frequently-asked-questions-17">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>When entering Rust's async world without previous async experience, and no benchmarks for what good async design patters look like, getting started with async can be a bit overwhelming.</li>
<li>Other languages which only have a single ecosystem seem to have a much better story for beginners since there's no fear of lock in, or ecosystem fomo about making the wrong choices early on.</li>
<li>This lack of documentation on design patterns, and solid guidance about the async ecosystem for unopiniated newcomers is partially made up for by Rust's community which often provides educated opinions on the design and technical choices one should make. Because of this getting started in async favors those who know where to find answers about Rust: blogs, Discord, Reddit, etc.</li>
</ul>
</li>
<li><strong>What are the sources for their story?</strong>
<ul>
<li>This is based on the author's personal experience</li>
</ul>
</li>
<li><strong>What documentation did the character read during this story?</strong>
<ul>
<li>Various blog posts of withoutboats</li>
<li>A blog post which spurred a lot of discussion about blocking in async: https://async.rs/blog/stop-worrying-about-blocking-the-new-async-std-runtime/</li>
<li>A nice blog post about blocking in Tokio, which still doesn't have any nice design patterns: https://ryhl.io/blog/async-what-is-blocking/</li>
<li>An example of design patterns being discussed for sync Rust in the book: https://doc.rust-lang.org/book/ch17-03-oo-design-patterns.html#trade-offs-of-the-state-pattern</li>
<li>Perhaps I should've read a bit more of Niko's blogs and his async interviews.</li>
</ul>
</li>
<li><strong>Why did you choose Barbara to tell their story?</strong>
<ul>
<li>Like the author of this story, Barbara had previous experience with Rust. Knowing where to find the community also played a significant part in this story. This story could be construed as how Barbara got started with async while starting to maintain some async projects.</li>
</ul>
</li>
<li><strong>How would their story have played out differently for the other characters?</strong>
<ul>
<li>Characters with previous async experience would probably have had a better experience getting started with async in Rust since they might know what design patterns to apply to async code.
On the other hand, since Rust's async story is noticeably different from other languages, having async experience in other languages might even be harmful by requiring the user to unlearn certain habits. I don't know if this is actually the case since I don't have any experience with async in other languages.</li>
<li>Characters which are less in touch with Rust's community than Barbara might have had a much worse time, since just skimming over the documentation might leave some lost, and unaware of common pitfalls. On the other hand, not having learned a lot about async through blog posts and other materials, might compel someone to read the documentation more thoroughly.</li>
</ul>
</li>
</ul>
<h1 id="-status-quo-stories-grace-deploys-her-service-and-hits-obstacles"><a class="header" href="#-status-quo-stories-grace-deploys-her-service-and-hits-obstacles">😱 Status quo stories: Grace deploys her service and hits obstacles</a></h1>
<h2 id="-warning-draft-status--5"><a class="header" href="#-warning-draft-status--5">🚧 Warning: Draft status 🚧</a></h2>
<p>This is a draft &quot;status quo&quot; story submitted as part of the brainstorming period. It is derived from real-life experiences of actual Rust users and is meant to reflect some of the challenges that Async Rust programmers face today.</p>
<h2 id="the-story-3"><a class="header" href="#the-story-3">The story</a></h2>
<p>When examining her service metrics, <a href="vision/status_quo/../characters/grace.html">Grace</a> notices tail latencies in the P99 that exceed their target. She identifies GC in the routing layer as the culprit. Grace follows industry trends and is already aware of Rust and its ecosystem at a high level. She decides to investigate rewriting the routing service in Rust.</p>
<p>To meet throughput requirements, Grace has already decided to use a thread-per-core model and minimize cross-thread communication. She explores available ecosystem options and finds no option that gets her exactly what she is looking for out of the box. However, she can use Tokio with minimal configuration to achieve her architecture.</p>
<p>A few months of frantic hacking follow.</p>
<p><img src="https://media.giphy.com/media/ule4vhcY1xEKQ/giphy.gif" alt="montage of cats typing" width=200></img></p>
<p>Soon enough, she and her team have a proof of concept working. They run some local stress tests and notice that 5% of requests hang and fail to respond. The client eventually times out. She cannot reproduce this problem when running one-off requests locally. It only shows up when sending above 200 requests-per-second. </p>
<p>She realizes that she doesn't have any tooling to give her insight into what's going on. She starts to add lots of logging, attempting to tie log entries to specific connections. Using an operating system tool, she can identify the socket addresses for the hung connections, so she also includes the socket addresses in each log message. She then filters the logs to find entries associated with hung connections. Of course, the logs only tell her what the connection managed to do successfully; they don't tell her why it stopped -- so she keeps going back to add more logging until she can narrow down the exact call that hangs.</p>
<p>Eventually, she identifies that the last log message is right before authenticating the request. An existing C library performs authentication, integrated with the routing service using a custom future implementation. She eventually finds a bug in the implementation that resulted in occasional lost wake-ups.</p>
<p>She fixes the bug. The service is now working as expected and meeting Grace's performance goals.</p>
<h2 id="-frequently-asked-questions-18"><a class="header" href="#-frequently-asked-questions-18">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>When coming from a background of network engineering, users will bring their own design choices around architecture.
<ul>
<li>Examples: <a href="http://seastar.io/">seastar</a> and <a href="https://www.datadoghq.com/blog/engineering/introducing-glommio/">Glommio</a></li>
</ul>
</li>
<li>There is a lack of debugging tools for async.</li>
<li>Writing futures by hand is error prone.</li>
</ul>
</li>
<li><strong>What are the sources for this story?</strong>
<ul>
<li>This is based on the experiences of helping a tokio user to diagnose a bug in their code.</li>
</ul>
</li>
<li><strong>Why did you choose Grace to tell this story?</strong>
<ul>
<li>The actual user who experienced this problem fit the profile of Grace.</li>
<li>The story is focused on the experience of people aiming to use workflows they are familiar with from C in a Rust setting.</li>
</ul>
</li>
<li><strong>How would this story have played out differently for the other characters?</strong>
<ul>
<li>Alan or Niklaus may well have had a much harder time diagnosing the problem due to not having as much of a background in systems programming. For example, they may not have known about the system tool that allowed them to find the list of dangling connections.</li>
</ul>
</li>
<li><strong>Could Grace have used another runtime to achieve the same objectives?</strong>
<ul>
<li>Maybe! But in this instance the people this story is based on were using tokio, so that's the one we wrote into the story.</li>
<li>(If folks want to expand this answer with details of how to achieve similar goals on other runtimes that would be welcome!)</li>
</ul>
</li>
</ul>
<h1 id="-status-quo-stories-niklaus-wants-to-share-knowledge"><a class="header" href="#-status-quo-stories-niklaus-wants-to-share-knowledge">😱 Status quo stories: Niklaus Wants to Share Knowledge</a></h1>
<h2 id="-warning-draft-status--6"><a class="header" href="#-warning-draft-status--6">🚧 Warning: Draft status 🚧</a></h2>
<p>This is a draft &quot;status quo&quot; story submitted as part of the brainstorming period. It is derived from real-life experiences of actual Rust users and is meant to reflect some of the challenges that Async Rust programmers face today. </p>
<p>If you would like to expand on this story, or adjust the answers to the FAQ, feel free to open a PR making edits (but keep in mind that, as they reflect peoples' experiences, status quo stories <a href="vision/status_quo/../how_to_vision/comment.html#comment-to-understand-or-improve-not-to-negate-or-dissuade">cannot be wrong</a>, only inaccurate). Alternatively, you may wish to <a href="vision/status_quo/../how_to_vision/status_quo.html">add your own status quo story</a>!</p>
<h2 id="the-story-4"><a class="header" href="#the-story-4">The story</a></h2>
<p>Niklaus, who sometimes goes by the pen name &quot;Starol Klichols&quot;, has authored some long-form documentation about Rust that people have found helpful. One could even go so far as to call this documentation a <a href="https://doc.rust-lang.org/stable/book/">&quot;book&quot;</a>.</p>
<p>Niklaus has typically minimized the use of crates in documentation like this as much as possible. Niklaus has limited time to dedicate to keeping the documentation up to date, and given the speed at which the ecosystem sometimes evolves, it's hard to keep up when crates are involved. Also, Niklaus would like to avoid limiting the readership of the documentation to the users of a particular crate only, and would like to avoid any accusations of favoritism.</p>
<p>But Niklaus would really really like to document async to avoid disappointing <a href="https://github.com/rust-lang/wg-async-foundations/blame/5ce418ac4076850f515034010cc51b707441f695/src/vision/status_quo/barbara_makes_their_first_steps_into_async.md#L22">people like Barbara</a>!</p>
<p>Niklaus was excited about <a href="https://github.com/rust-lang/rust/pull/65875">the RFC proposing that <code>block_on</code> be added to the stdlib</a>, because it seemed like that would solve Niklaus' problems. Niklaus would really like to include <code>async</code> in a big update to the documentation. No pressure.</p>
<h2 id="-frequently-asked-questions-19"><a class="header" href="#-frequently-asked-questions-19">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What are the morals of the story?</strong>
<ul>
<li>Writing documentation to go with the language/stdlib for something that is half in the language/stdlib and half in the ecosystem is hard.</li>
<li>This is related to <a href="https://rust-lang.github.io/wg-async-foundations/vision/status_quo/barbara_makes_their_first_steps_into_async.html">Barbara's story</a> about wanting to get started without needing to pick an executor. </li>
<li>There are topics of async that apply no matter what executor you pick, but it's hard to explain those topics without picking an executor to demonstrate with.</li>
<li>We all have too much work to do and not enough time.</li>
</ul>
</li>
<li><strong>What are the sources for this story?</strong>
<ul>
<li>It me and Steve. Surprise!</li>
<li><a href="https://github.com/rust-lang/book/issues/1275">We've wanted to add async to the book for a long time</a>.</li>
<li>So far, we use exactly one crate in the book, <code>rand</code>, and a recent update to <code>rand</code> caused readers confusion and caused a bunch of work on our part. <a href="https://github.com/rust-lang/book/pull/2542">Take a look at all the issues linked to this PR</a>. I really really really don't want to use more crates in the book.</li>
</ul>
</li>
<li><strong>Why did you choose <em>Niklaus</em> to tell this story?</strong>
<ul>
<li>Niko said I couldn't add new characters.</li>
</ul>
</li>
<li><strong>How would this story have played out differently for the other characters?</strong>
<ul>
<li>I happen to know that the next version of Programming Rust, whose authors might be described as different characters, includes <code>async</code> and uses <code>async-std</code>. So it's possible to just pick an executor and add async to the book, but I don't wanna.</li>
</ul>
</li>
</ul>
<h1 id="-shiny-future-where-we-want-to-get-to"><a class="header" href="#-shiny-future-where-we-want-to-get-to">✨ Shiny future: Where we want to get to</a></h1>
<h3 id="-not-time-for-this-yet--1"><a class="header" href="#-not-time-for-this-yet--1">🛑 Not time for this yet 🛑</a></h3>
<p>We're not really ready to work on this section yet. We're still focused on writing out the <a href="vision/./status_quo.html">status quo</a>.</p>
<h2 id="what-it-this"><a class="header" href="#what-it-this">What it this</a></h2>
<p>The &quot;shiny future&quot; is here to tell you what we are trying to build over the next 2 to 3 years. That is, it presents our &quot;best guess&quot; as to what will look like a few years from now. When describing specific features, it also embeds links to <a href="vision/../design_notes.html">design notes</a> that describe the constraints and general plans around that feature.</p>
<h3 id="think-big----too-big-if-you-have-to"><a class="header" href="#think-big----too-big-if-you-have-to">Think big -- too big, if you have to</a></h3>
<p>You'll notice that the ideas in this document are <strong>maximalist and ambitious</strong>. They stake out an opinionated position on how the ergonomics of Async I/O should feel. This position may not, in truth, be attainable, and for sure there will be changes along the way. Sometimes the realities of how computers actually work may prevent us from doing all that we'd like to. That's ok. This is a dream and a goal.</p>
<p>We fully expect that the designs and stories described in this document will change as we work towards realizing them. When there are areas of particular uncertainty, we use the Frequently Asked Questions and the design docs to call them out.</p>
<h2 id="where-are-the-stories-1"><a class="header" href="#where-are-the-stories-1">Where are the stories?</a></h2>
<p>We haven't written these yet!</p>
<h1 id="-shiny-future-stories-template"><a class="header" href="#-shiny-future-stories-template">✨ Shiny future stories: template</a></h1>
<p><em>This is a template for adding new &quot;shiny future&quot; stories. To propose a new shiny future PR, do the following:</em></p>
<ul>
<li><em>Create a new file in the <a href="https://github.com/rust-lang/wg-async-foundations/tree/master/src/vision/shiny_future"><code>shiny_future</code></a> directory named something like <code>Alan_loves_foo.md</code> or <code>Grace_does_bar_and_its_great.md</code>, and start from <a href="https://raw.githubusercontent.com/rust-lang/wg-async-foundations/master/src/vision/shiny_future/template.md">the raw source from this template</a>. You can replace all the italicized stuff. :)</em></li>
<li><em>Do not add a link to your story to the <a href="https://github.com/rust-lang/wg-async-foundations/blob/master/src/SUMMARY.md"><code>SUMMARY.md</code></a> file; we'll do it after merging, otherwise there will be too many conflicts.</em></li>
</ul>
<p><em>For more detailed instructions, see the <a href="vision/shiny_future/../how_to_vision/shiny_future.html">How To Vision: Shiny Future</a> page!</em></p>
<h3 id="-not-time-for-this-yet--2"><a class="header" href="#-not-time-for-this-yet--2">🛑 Not time for this yet 🛑</a></h3>
<p>We are not yet accepting shiny future story ideas!</p>
<h2 id="the-story-5"><a class="header" href="#the-story-5">The story</a></h2>
<p><em>Write your story here! Feel free to add subsections, citations, links, code examples, whatever you think is best.</em></p>
<h2 id="-frequently-asked-questions-20"><a class="header" href="#-frequently-asked-questions-20">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What status quo story or stories are you retelling?</strong>
<ul>
<li><em>Link to the status quo stories here. If there isn't a story that you're retelling, <a href="vision/shiny_future/../how_to_vision/status_quo.html">write it</a>!</em></li>
</ul>
</li>
<li><strong>What is <a href="vision/shiny_future/../characters/alan.html">Alan</a> most excited about in this future? Is he disappointed by anything?</strong>
<ul>
<li><em>Think about Alan's top priority (performance) and the expectations he brings (ease of use, tooling, etc). How do they fare in this future?</em></li>
</ul>
</li>
<li><strong>What is <a href="vision/shiny_future/../characters/grace.html">Grace</a> most excited about in this future? Is she disappointed by anything?</strong>
<ul>
<li><em>Think about Grace's top priority (memory safety) and the expectations she brings (still able to use all the tricks she knows and loves). How do they fare in this future?</em></li>
</ul>
</li>
<li><strong>What is <a href="vision/shiny_future/../characters/niklaus.html">Niklaus</a> most excited about in this future? Is he disappointed by anything?</strong>
<ul>
<li><em>Think about Niklaus's top priority (accessibility) and the expectations he brings (strong community that will support him). How do they fare in this future?</em></li>
</ul>
</li>
<li><strong>What is <a href="vision/shiny_future/../characters/barbara.html">Barbara</a> most excited about in this future? Is she disappointed by anything?</strong>
<ul>
<li><em>Think about Barbara's top priority (productivity, maintenance over time) and the expectations she brings (fits well with Rust). How do they fare in this future?</em></li>
</ul>
</li>
<li><strong>If this is an alternative to another shiny future, which one, and what motivated you to write an alternative?</strong> (Optional)
<ul>
<li><em>Cite the other story. Be specific, but focus on what you like about your version, not what you dislike about the other.</em></li>
<li><em>If this is not an alternative, you can skip this one.</em></li>
</ul>
</li>
<li><strong>What <a href="vision/shiny_future/../projects.html">projects</a> benefit the most from this future?</strong></li>
<li><strong>Are there any <a href="vision/shiny_future/../projects.html">projects</a> that are hindered by this future?</strong></li>
<li><strong>What are the incremental steps towards realizing this shiny future?</strong> (Optional)
<ul>
<li><em>Talk about the actual work we will do. You can link to <a href="vision/shiny_future/../design_docs.html">design docs</a> or even add new ones, as appropriate.</em></li>
<li><em>You don't have to have the whole path figured out yet!</em></li>
</ul>
</li>
<li><strong>Does realizing this future require cooperation between many projects?</strong> (Optional)
<ul>
<li><em>For example, if you are describing an interface in libstd that runtimes will have to implement, talk about that.</em></li>
</ul>
</li>
</ul>
<h1 id="-the-roadmap-what-were-doing-in-2021"><a class="header" href="#-the-roadmap-what-were-doing-in-2021">📅 The roadmap: what we're doing in 2021</a></h1>
<p>This page describes the current plans for 2021.
It is updated on a monthly basis.</p>
<h3 id="-not-time-for-this-yet--3"><a class="header" href="#-not-time-for-this-yet--3">🛑 Not time for this yet 🛑</a></h3>
<p>We're not really ready to work on this section yet. We're still focused on writing out the <a href="vision/./status_quo.html">status quo</a>. What you see here are really just placeholders to give you the idea of what this section might look like.</p>
<h2 id="key"><a class="header" href="#key">Key</a></h2>
<table><thead><tr><th>Emoji</th><th>Meaning</th></tr></thead><tbody>
<tr><td>🥬</td><td>&quot;Healthy&quot; -- on track with the plan as described in the doc</td></tr>
<tr><td>✏️</td><td>&quot;Planning&quot; -- Still figuring out the plan</td></tr>
<tr><td>🤒</td><td>&quot;Worried&quot; -- things are looking a bit tricky, plans aren't working out</td></tr>
<tr><td>🏖️</td><td>&quot;On vacation&quot; -- taking a break right now</td></tr>
<tr><td>⚰️</td><td>We gave up on this idea =)</td></tr>
</tbody></table>
<h2 id="roadmap-items"><a class="header" href="#roadmap-items">Roadmap items</a></h2>
<table><thead><tr><th>Plan</th><th>Owner</th><th>Status</th><th>Last updated</th></tr></thead><tbody>
<tr><td><a href="vision/../design_docs/async_fn_in_traits.html">Async functions in traits</a></td><td>nikomatsakis</td><td>🥬</td><td>2021-02</td></tr>
</tbody></table>
<h1 id="-triage-meetings"><a class="header" href="#-triage-meetings">🔍 Triage meetings</a></h1>
<h2 id="when-where"><a class="header" href="#when-where">When, where</a></h2>
<p>The weekly triage meeting is held on <a href="./welcome.html#zulip">Zulip</a> at 13:00 US Eastern time on Fridays (<a href="https://calendar.google.com/event?action=TEMPLATE&amp;tmeid=M2VhYjRjczZxanE5ODcwbzR1bnZsNTV0MGFfMjAyMTAyMjZUMTgwMDAwWiA2dTVycnRjZTZscnR2MDdwZmkzZGFtZ2p1c0Bn&amp;tmsrc=6u5rrtce6lrtv07pfi3damgjus%40group.calendar.google.com&amp;scp=ALL">google calendar event for meeting</a>).</p>
<h2 id="so-you-want-to-fix-a-bug"><a class="header" href="#so-you-want-to-fix-a-bug">So you want to fix a bug?</a></h2>
<p>If you're interested in fixing bugs, there is no need to wait for the triage meeting.
Take a look at the <a href="https://github.com/rust-lang/rust/issues?q=is%3Aopen+label%3AE-mentor+label%3AA-async-await+no%3Aassignee">mentored async-await bugs that have no assignee</a>.
Every mentored bug should have a few comments.
If you see one you like, you can add the <code>@rustbot claim</code> comment into the bug and start working on it!
Feel to reach out to the mentor on <a href="./welcome.html#zulip">Zulip</a> to ask questions.</p>
<h2 id="project-board"><a class="header" href="#project-board">Project board</a></h2>
<p>The <a href="https://github.com/orgs/rust-lang/projects/2">project board</a> tracks various bugs and other work items for the async foundation group.
It is used to drive the triage process.</p>
<h2 id="triage-process"><a class="header" href="#triage-process">Triage process</a></h2>
<p>In our weekly triage meetings, we take new issues assigned <a href="https://github.com/rust-lang/rust/labels/A-async-await"><code>A-async-await</code></a> and categorize them. 
The process is:</p>
<ul>
<li>Review the <a href="https://github.com/orgs/rust-lang/projects/2">project board</a>, from right to left:
<ul>
<li>Look at what got <strong>Done</strong>, and celebrate! :tada:</li>
<li>Review <strong>In progress</strong> issues to check we are making progress and there is a clear path to finishing (otherwise, move to the appropriate column)</li>
<li>Review <strong>Blocked</strong> issues to see if there is anything we can do to unblock</li>
<li>Review <strong>Claimed</strong> issues to see if they are in progress, and if the assigned person still intends to work on it</li>
<li>Review <strong>To do</strong> issues and assign to anyone who wants to work on something</li>
</ul>
</li>
<li>Review <a href="https://github.com/search?q=org%3Arust-lang+is%3Aissue+label%3AA-async-await+is%3Aopen+-label%3AAsyncAwait-Triaged&amp;type=Issues">uncategorized issues</a>
<ul>
<li>Mark <code>P-low</code>, <code>P-medium</code>, or <code>P-high</code></li>
<li>Add <code>P-high</code> and <em>assigned</em> <code>E-needs-mentor</code> issues to the <a href="https://github.com/orgs/rust-lang/projects/2">project board</a></li>
<li>Mark <code>AsyncAwait-triaged</code></li>
</ul>
</li>
<li>If there's still a shortage of <strong>To do</strong> issues, review the list of <a href="https://github.com/search?q=org%3Arust-lang+is%3Aissue+label%3AAsyncAwait-Triaged+label%3AP-medium+is%3Aopen&amp;type=Issues"><code>P-medium</code></a> or <a href="https://github.com/search?q=org%3Arust-lang+is%3Aissue+label%3AAsyncAwait-Triaged+label%3AP-low+is%3Aopen&amp;type=Issues"><code>P-low</code></a> issues for candidates</li>
</ul>
<h2 id="mentoring"><a class="header" href="#mentoring">Mentoring</a></h2>
<p>If an issue is a good candidate for mentoring, mark <code>E-needs-mentor</code> and try to find a mentor.</p>
<p>Mentors assigned to issues should write up mentoring instructions. 
<strong>Often, this is just a couple lines pointing to the relevant code.</strong> 
Mentorship doesn't require intimate knowledge of the compiler, just some familiarity and a willingness to look around for the right code.</p>
<p>After writing instructions, mentors should un-assign themselves, add <code>E-mentor</code>, and remove <code>E-needs-mentor</code>. 
On the project board, if a mentor is assigned to an issue, it should go to the <strong>Claimed</strong> column until mentoring instructions are provided. 
After that, it should go to <strong>To do</strong> until someone has volunteered to work on it.</p>
<h1 id="-design-documents"><a class="header" href="#-design-documents">🔬 Design documents</a></h1>
<p>The <strong>design documents</strong> (or &quot;design docs&quot;, more commonly) describe potential designs. These docs vary greatly in terms of their readiness to be implemented:</p>
<ul>
<li>Early on, they describe a vague idea for a future. Often this takes the shape of capturing constraints on the solution, rather than the solution itself.</li>
<li>When a feature is getting ready to ship, they can evolve into a full blown RFC, with links to tracking issues or other notes.</li>
</ul>
<h2 id="early-stage-design-docs"><a class="header" href="#early-stage-design-docs">Early stage design docs</a></h2>
<p>In the early stages, design docs are meant to capture interesting bits of &quot;async design space&quot;. They are often updated to capture the results of a fruitful conversation or thread which uncovered contraints or challenges in solving a particular problem. They will capture a combination of the following:</p>
<ul>
<li>use cases;</li>
<li>interesting aspects to the design;</li>
<li>alternatives;</li>
<li>interactions with other features.</li>
</ul>
<h2 id="late-stage-design-docs"><a class="header" href="#late-stage-design-docs">Late stage design docs</a></h2>
<p>As a design progresses, the doc should get more and more complete, until it becomes something akin to an RFC. (Often, at that point, we will expand the design document into a directory, adding an actual RFC draft and other contents; those things can live in this repo or elsewhere, depending.) Once we decide to put a design doc onto the roadmap, it will also contain links to tracking issues or other places to track the status.</p>
<h1 id="-yield-safe-lint"><a class="header" href="#-yield-safe-lint">⚠️ Yield-safe lint</a></h1>
<h2 id="use-case"><a class="header" href="#use-case">Use-case</a></h2>
<p>Some types should not be held across a &quot;yield&quot; bound. A typical example is a <code>MutexGuard</code>:</p>
<pre><code class="language-rust ignore">async fn example(x: &amp;Lock&lt;u32&gt;) {
    let data = x.lock().unwrap();
    something().await;
    *data += 1;
}

async fn something() { }
</code></pre>
<p>In practice, a lot of these issues are avoided because <code>MutexGuard</code> is not <code>Send</code>, but single-thread runtimes hit these issues.</p>
<h2 id="types-where-this-would-apply"><a class="header" href="#types-where-this-would-apply">Types where this would apply</a></h2>
<ul>
<li><code>MutexGuard</code> for mutexes, read-write locks</li>
<li>Guards for ref-cells</li>
<li>Things that might use these types internally and wish to bubble it up</li>
</ul>
<h2 id="precedent-and-related-questions"><a class="header" href="#precedent-and-related-questions">Precedent and related questions</a></h2>
<ul>
<li>The <code>#[must_use]</code> lint on types, we would want their design to work very closely.</li>
<li>Non-async-friendly functions like <code>sleep</code> or <code>task::block_on</code>.</li>
</ul>
<h1 id="-stream-trait"><a class="header" href="#-stream-trait">☔ Stream trait</a></h1>
<ul>
<li><a href="https://docs.rs/futures/0.3/futures/stream/trait.Stream.html">Current definition</a></li>
</ul>
<h2 id="trait-definition"><a class="header" href="#trait-definition">Trait definition</a></h2>
<pre><code class="language-rust ignore">pub trait Stream {
    type Item;

    fn poll_next(
        self: Pin&lt;&amp;mut Self&gt;,
        cx: &amp;mut Context&lt;'_&gt;,
    ) -&gt; Poll&lt;Option&lt;Self::Item&gt;&gt;;

    #[inline]
    fn size_hint(&amp;self) -&gt; (usize, Option&lt;usize&gt;) {
        (0, None)
    }
}
</code></pre>
<h2 id="concerns"><a class="header" href="#concerns">Concerns</a></h2>
<h3 id="poll-based-design"><a class="header" href="#poll-based-design">Poll-based design</a></h3>
<ul>
<li>You have to think about Pin if you implement this trait.</li>
<li>Combinators can be more difficult.</li>
<li>One solution: <a href="design_docs/./generator_syntax.html">generator syntax</a>.</li>
</ul>
<h3 id="attached-streams-are-commonly-desired"><a class="header" href="#attached-streams-are-commonly-desired">Attached streams are commonly desired</a></h3>
<p>Sometimes streams need to reuse internal storage (<a href="http://smallcultfollowing.com/babysteps/blog/2019/12/10/async-interview-2-cramertj-part-2/#the-need-for-streaming-streams-and-iterators">Discussion</a>).</p>
<h3 id="combinators"><a class="header" href="#combinators">Combinators</a></h3>
<ul>
<li>Currently the combinations are stored in the <a href="https://docs.rs/futures/0.3/futures/stream/trait.StreamExt.html"><code>StreamExt</code></a> module.</li>
<li>In some cases, this is because of the lack of async closures support.
<ul>
<li>Also serves as a &quot;semver barrier&quot;.</li>
<li>Also no-std compatibility.</li>
</ul>
</li>
<li>One question: what combinators (if any) to include when stabilizing?
<ul>
<li>e.g., <a href="https://docs.rs/futures/0.3/futures/stream/trait.StreamExt.html#method.poll_next_unpin"><code>poll_next_unpin</code></a> can make working with pin easier, albeit at a loss of generality
<ul>
<li>folks who are new to pinning could use this method, and it can help us to guide the diagnostics by suggesting that they <code>Box::pin</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="--generator-syntax"><a class="header" href="#--generator-syntax">⚡  Generator syntax</a></h1>
<ul>
<li>It would be useful to be able to write a function to return an iterator or (in the async context) a generator</li>
<li>The basic shape might be (modulo bikeshedding) <code>gen fn</code> that contains <code>yield</code></li>
<li>Some question marks:
<ul>
<li>How general of a mechanism do we want?
<ul>
<li>Just target iterators and streams, or shoot for something more general?</li>
</ul>
</li>
</ul>
</li>
<li>Some of the question marks that arise if you go beyond iterators and streams:
<ul>
<li>Return values that are not unit</li>
<li>Have yield return a value that is passed by the caller of <code>next</code> (&quot;resume args&quot;)</li>
</ul>
</li>
</ul>
<h1 id="-asyncread-asyncwrite-traits"><a class="header" href="#-asyncread-asyncwrite-traits">📝 AsyncRead, AsyncWrite traits</a></h1>
<h1 id="-async-fn-in-traits"><a class="header" href="#-async-fn-in-traits">🧬 Async fn in traits</a></h1>
<ul>
<li><a href="http://smallcultfollowing.com/babysteps/blog/2019/10/26/async-fn-in-traits-are-hard/">Why async fn in traits are hard</a></li>
</ul>
<h2 id="general-goal"><a class="header" href="#general-goal">General goal</a></h2>
<pre><code class="language-rust ignore">trait Foo {
    // Currently disallowed:
    async fn bar();
}
</code></pre>
<h2 id="concerns-1"><a class="header" href="#concerns-1">Concerns</a></h2>
<h3 id="how-to-name-the-resulting-future"><a class="header" href="#how-to-name-the-resulting-future">How to name the resulting future</a></h3>
<p>If you wanted to name the future that results from calling <code>bar</code> (or whatever), you can't.</p>
<p>Also true for functions <code>fn bar() -&gt; impl Trait</code>.</p>
<h3 id="requiring-send-on-futures"><a class="header" href="#requiring-send-on-futures">Requiring <code>Send</code> on futures</a></h3>
<p><a href="https://internals.rust-lang.org/t/how-often-do-you-want-non-send-futures/10360">Relevant thread</a></p>
<pre><code class="language-rust ignore">async fn foo() {}

// desugars to
fn foo() -&gt; impl Future&lt;Output = ()&gt; { } // resulting type is Send if it can be

// alternative desugaring we chose not to adopt would require Send
fn foo() -&gt; impl Future + Send { }
</code></pre>
<p>If I want to constrain the future I get back from a method, it is difficult to do without a name:</p>
<pre><code class="language-rust ignore">trait Service {
    async fn request(&amp;self);
}

fn parallel_service&lt;S: Service&gt;()
where
    S::Future: Send,
{
    ...
}
</code></pre>
<ul>
<li>Should this be solved at the impl trait layer</li>
<li>Or should we specialize something for async functions</li>
<li>Would be nice, if there are many, associated types, to have some shorthand</li>
</ul>
<h2 id="example-use-case-the-service"><a class="header" href="#example-use-case-the-service">Example use case: the Service</a></h2>
<pre><code class="language-rust ignore">trait Service {
    type Future: Future&lt;Output = Response&gt;;

    fn request(&amp;self, ...) -&gt; Self::Future;
}

impl Service for MyService {
    type Future = impl Future&lt;Output = Response&gt;;

    fn request(&amp;self) -&gt; Self::Future {
        async move { .. }
    }
}
</code></pre>
<ul>
<li>Dependent on impl Trait, see lang-team repo</li>
</ul>
<h2 id="example-use-case-capturing-lifetimes-of-arguments"><a class="header" href="#example-use-case-capturing-lifetimes-of-arguments">Example use case: capturing lifetimes of arguments</a></h2>
<pre><code class="language-rust ignore">trait MyMethod {
    async fn foo(&amp;self);
}
</code></pre>
<h2 id="-frequently-asked-questions-21"><a class="header" href="#-frequently-asked-questions-21">🤔 Frequently Asked Questions</a></h2>
<ul>
<li><strong>What do people say about this to their friends on twitter?</strong>
<ul>
<li>(Explain your key points here)</li>
</ul>
</li>
</ul>
<h1 id="-mutex-future-aware"><a class="header" href="#-mutex-future-aware">🔒 Mutex (future-aware)</a></h1>
<p><a href="https://github.com/Diggsey/posts/tree/master/async-mutexes">Description of various challenges with async mutexes</a></p>
<h1 id="-async-aware-channels"><a class="header" href="#-async-aware-channels">📺 Async aware channels</a></h1>
<h1 id="-async-closures"><a class="header" href="#-async-closures">📦 Async closures</a></h1>
<h1 id="-join-combinator"><a class="header" href="#-join-combinator">🤝 Join combinator</a></h1>
<h1 id="-select-combinator"><a class="header" href="#-select-combinator">🤷‍♀️ Select combinator</a></h1>
<h1 id="-sink-trait"><a class="header" href="#-sink-trait">🚰 Sink trait</a></h1>
<h1 id="-async-main"><a class="header" href="#-async-main">🎇 Async main</a></h1>
<h2 id="what-is-it"><a class="header" href="#what-is-it">What is it?</a></h2>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<h2 id="frequently-asked-questions"><a class="header" href="#frequently-asked-questions">Frequently Asked Questions</a></h2>
<h1 id="-async-drop"><a class="header" href="#-async-drop">🗑️ Async drop</a></h1>
<h1 id="-async-lifecycle"><a class="header" href="#-async-lifecycle">♻️ Async lifecycle</a></h1>
<h1 id="-completion-based-futures"><a class="header" href="#-completion-based-futures">⏳ Completion-based futures</a></h1>
<p><a href="https://boats.gitlab.io/blog/post/io-uring">Notes on io_uring</a></p>
<h1 id="-conversations"><a class="header" href="#-conversations">💬 Conversations</a></h1>
<p>This section contains notes and summaries from conversations that we have had with people are using Rust and async and describing their experiences. These conversations and links are used as &quot;evidence&quot; when building <a href="vision/status_quo.html">the &quot;status quo&quot; section</a>.</p>
<h2 id="not-exhaustive-nor-mandatory"><a class="header" href="#not-exhaustive-nor-mandatory">Not exhaustive nor mandatory</a></h2>
<p>This section is not meant to be an &quot;exhaustive list&quot; of all sources. That would be impossible. Many conversations are short, not recorded, and hard to summaize. Others are subject to NDA. We certainly don't require that all claims in the <a href="vision/status_quo.html">status quo</a> section are backed by evidence found here. Still, it's useful to have a place to dump notes and things for future reference.</p>
<h1 id="-2021-02-12-twitter-thread"><a class="header" href="#-2021-02-12-twitter-thread">🐦 2021-02-12 Twitter thread</a></h1>
<p>Notes taken from the thread in response to <a href="https://twitter.com/nikomatsakis/status/1359454255971770372">Niko's tweet</a>.</p>
<ul>
<li><a href="https://twitter.com/enzo_mdd/status/1359544617121820676">Enzo</a>
<ul>
<li>A default event loop. &quot;choosing your own event loop&quot; takes time, then you have to understand the differences between each event loop etc.</li>
<li>Standard way of doing <code>for await (variable of iterable)</code> would be nice.</li>
<li>Standard promise combinators.</li>
</ul>
</li>
<li><a href="https://twitter.com/creepy_owlet/status/1359649695103131649">creepy_owlet</a>
<ul>
<li>https://github.com/dtantsur/rust-osauth/blob/master/src/sync.rs</li>
</ul>
</li>
<li>async trait --
<ul>
<li>https://twitter.com/jcsp_tweets/status/1359820431151267843</li>
<li>&quot;I thought async was built-in&quot;?</li>
<li>nasty compiler errors</li>
<li><a href="https://www.fpcomplete.com/blog/ownership-puzzle-rust-async-hyper/">ownership puzzle</a> blog post</li>
</ul>
</li>
<li><a href="https://twitter.com/rubdos/status/1359462402702606336">rubdos</a>
<ul>
<li><a href="https://www.rubdos.be/corona/qt/rust/tokio/actix/2020/05/23/actix-qt.html">blog post</a> describes integrating two event loops</li>
<li>mentions desire for runtime independent libraries</li>
<li>qt provides a mechanism to integrate one's own event loop</li>
<li><a href="https://github.com/rust-lang/rust/issues/60605">llvm bug</a> generates invalid arm7 assembly</li>
</ul>
</li>
<li><a href="https://twitter.com/alexmiberry/status/1359559299161325581">alexmiberry</a>
<ul>
<li>kotlin/scala code, blocked by absence of async trait</li>
</ul>
</li>
<li>helpful blog post
<ul>
<li><a href="http://jamesmcm.github.io/blog/2020/05/06/a-practical-introduction-to-async-programming-in-rust/">jamesmcm</a>
<ul>
<li>note that <code>join</code> and <code>Result</code> play poorly together
<ul>
<li><a href="https://github.com/jamesmcm/async-rust-example/blob/async-std/client_async/src/main.rs#L50-L59">async-std version</a></li>
<li><a href="https://github.com/jamesmcm/async-rust-example/blob/master/client_async/src/main.rs#L40-L61">tokio version</a> has some wild &quot;double question marks&quot; -- I guess that spawn must be adding a layer of <code>Result</code>?</li>
</ul>
</li>
</ul>
</li>
<li>the post mentions rayon but this isn't really a case where one ought to use rayon -- still, Rayon's APIs here are SO much nicer :)</li>
<li><a href="http://jamesmcm.github.io/blog/2020/04/19/data-engineering-with-rust-and-aws-lambda/#en">rust aws and lambda</a></li>
</ul>
</li>
<li><a href="https://github.com/jamesmcm/s3rename/issues/16">issue requiring async drop</a></li>
<li><a href="https://fasterthanli.me/articles/getting-in-and-out-of-trouble-with-rust-futures">fasterthanlime</a> -- 
<ul>
<li>this post is amazing</li>
<li>the discussion on Send bounds and the ways to debug it is great</li>
</ul>
</li>
<li><a href="https://github.com/thanethomson/async-channel-abs/blob/master/src/runtime.rs">bridging different runtimes using GATs</a></li>
<li>first server app, <a href="https://twitter.com/richardsabow/status/1345815109201842178">great thread with problems</a>
<ul>
<li>&quot;I wasn't expecting that it will be easy but after Go and Node.js development it felt extremely hard to start off anything with Rust.&quot;</li>
<li>&quot;felt like I have to re-learn everything from scratch: structuring project and modules, dependency injection, managing the DB and of course dealing with concurrency&quot;</li>
<li>common thread: poor docs, though only somewhat in async libraries
<ul>
<li>I had enums in the DB and it was a bit more complex to map them to my custom Rust enums but I succeeded with the help of a couple of blog posts – and not with Diesel documentation</li>
<li>I used Rusoto for dealing with AWS services. It's also pretty straightforward and high quality package – but again the documentation was sooo poor. </li>
</ul>
</li>
</ul>
</li>
<li><a href="https://t.co/4rlyfUlFES?amp=1">implaustin</a> wrote a <a href="https://t.co/4rlyfUlFES?amp=1">very nice post</a> but it felt more like a &quot;look how well this worked&quot; post than one with actionable feedback
<ul>
<li>&quot;Async has worked well so far.  My top wishlist items are Sink and Stream traits in std.  It's quite difficult to abstract over types that asynchronously produce or consume values.&quot;</li>
<li>&quot;AsyncRead/AsyncWrite work fine for files, tcp streams, etc.  But once you are past I/O and want to pass around structs, Sink and Stream are needed.  One example of fragmentation is that Tokio channels used to implement the futures Sink/Stream traits, but no longer do in 1.0.&quot;</li>
<li>&quot;I usually use Sink/Stream to abstract over different async channel types.  Sometimes to hide the details of external dependencies from a task (e.g. where is this data going?).  And sometimes to write common utility methods.&quot;</li>
<li>&quot;One thing I can think of: there are still a lot of popular libraries that don't have async support (or are just getting there).  Rocket, Criterion, Crossterm's execute, etc.&quot;</li>
</ul>
</li>
<li><a href="https://twitter.com/EchoRior/status/1359964691305496579">EchoRior</a>:
<ul>
<li>&quot;I've written a bit of rust before, but rust is my first introduction to Async. My main gripes are that it's hard to figure our what the &quot;blessed&quot; way of doing async is. I'd love to see async included in the book, but I understand that async is still evolving too much for that.&quot;</li>
<li>&quot;Adding to the confusion: theres multiple executors, and they have a bit of lock in. Async libraries being dependent on which executor version I use is also confusing for newcomers. In other langs, it seems like one just uses everything from the stdlib and everything is compatible&quot;</li>
<li>&quot;That kind of gave me a lot of hesitation/fomo in the beginning, because it felt like I had to make some big choices around my tech stack that I felt I would be stuck with later. I ended up chatting about this in the discord &amp; researching for multiple days before getting started.&quot;</li>
<li>&quot;Also, due to there not being a &quot;blessed&quot; approach, I don't know if I'm working with some misconceptions around async in rust, and will end up discovering I will need to redo large parts of what I wrote.&quot;</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
